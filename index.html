<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Operativo - DataVial</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        html {
            font-size: 13px;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            display: flex;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
            font-size: 0.95rem;
        }

        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }

        .sidebar {
            width: 300px;
            background: #ffffff;
            color: #333;
            display: flex;
            flex-direction: column;
            box-shadow: 3px 0 15px rgba(0, 0, 0, 0.08);
            position: fixed;
            height: 100vh;
            z-index: 100;
            border-right: 1px solid #eaeaea;
            transition: all 0.3s ease;
        }

        body.dark-mode .sidebar {
            background: #1e1e1e;
            border-right: 1px solid #333;
            color: #e0e0e0;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .logo {
            padding: 25px 15px;
            border-bottom: 1px solid #eaeaea;
            text-align: center;
            background: #ffffff;
            transition: background-color 0.3s, border-color 0.3s;
            position: relative;
            min-height: 110px;
            flex-shrink: 0;
        }

        .sidebar.collapsed .logo {
            padding: 18px 8px;
            min-height: 70px;
        }

        body.dark-mode .logo {
            background: #1e1e1e;
            border-bottom: 1px solid #333;
        }

        .logo h2 {
            font-size: 1.8rem;
            font-weight: 800;
            margin-top: 12px;
            letter-spacing: 1px;
            color: #2a5298;
            transition: color 0.3s;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        body.dark-mode .logo h2 {
            color: #4d8aff;
        }

        .sidebar.collapsed .logo h2 {
            opacity: 0;
            display: none;
        }

        .menu-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: hidden;
        }

        .menu-modules {
            flex: 1;
            padding: 25px 0;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .menu-modules::-webkit-scrollbar {
            width: 5px;
            background: transparent;
        }

        .menu-modules::-webkit-scrollbar-thumb {
            background-color: rgba(42, 82, 152, 0.3);
            border-radius: 3px;
            transition: background-color 0.3s;
        }

        .menu-modules::-webkit-scrollbar-thumb:hover {
            background-color: rgba(42, 82, 152, 0.5);
        }

        body.dark-mode .menu-modules::-webkit-scrollbar-thumb {
            background-color: rgba(77, 138, 255, 0.3);
        }

        body.dark-mode .menu-modules::-webkit-scrollbar-thumb:hover {
            background-color: rgba(77, 138, 255, 0.5);
        }

        .module-item {
            display: flex;
            align-items: center;
            gap: 18px;
            padding: 18px 25px;
            color: #555;
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s;
            border-left: 4px solid transparent;
            margin: 6px 12px;
            border-radius: 8px;
            white-space: nowrap;
            overflow: hidden;
        }

        .sidebar.collapsed .module-item {
            padding: 18px;
            justify-content: center;
        }

        .sidebar.collapsed .module-item span {
            display: none;
        }

        body.dark-mode .module-item {
            color: #b0b0b0;
        }

        .module-item:hover {
            background: #f0f5ff;
            color: #2a5298;
            border-left: 4px solid #2a5298;
        }

        body.dark-mode .module-item:hover {
            background: #2d3748;
            color: #4d8aff;
            border-left: 4px solid #4d8aff;
        }

        .module-item.active {
            background: #e8f0ff;
            color: #1e3c72;
            border-left: 4px solid #1e3c72;
            font-weight: 600;
        }

        body.dark-mode .module-item.active {
            background: #2a3a5a;
            color: #a3c4ff;
            border-left: 4px solid #4d8aff;
        }

        .module-item i {
            width: 26px;
            text-align: center;
            font-size: 1.2rem;
            color: #2a5298;
            transition: color 0.3s;
            flex-shrink: 0;
        }

        body.dark-mode .module-item i {
            color: #4d8aff;
        }

        .toggle-sidebar-btn {
            position: absolute;
            top: 50%;
            right: -16px;
            transform: translateY(-50%);
            background: #2a5298;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            z-index: 101;
        }

        .toggle-sidebar-btn:hover {
            background: #1e3c72;
            transform: translateY(-50%) scale(1.15);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        body.dark-mode .toggle-sidebar-btn {
            background: #4d8aff;
        }

        body.dark-mode .toggle-sidebar-btn:hover {
            background: #3a6bd6;
        }

        .sidebar.collapsed .toggle-sidebar-btn i {
            transform: rotate(180deg);
        }

        .dark-mode-toggle {
            padding: 22px 18px;
            border-bottom: 1px solid #eaeaea;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f8fafc;
            transition: background-color 0.3s, border-color 0.3s;
            flex-shrink: 0;
        }

        .sidebar.collapsed .dark-mode-toggle {
            padding: 22px 8px;
            justify-content: center;
        }

        .sidebar.collapsed .dark-mode-label {
            display: none;
        }

        body.dark-mode .dark-mode-toggle {
            border-bottom: 1px solid #333;
            background: #2d2d2d;
        }

        .dark-mode-label {
            font-size: 0.95rem;
            color: #555;
            font-weight: 500;
            transition: color 0.3s;
            white-space: nowrap;
        }

        body.dark-mode .dark-mode-label {
            color: #b0b0b0;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
            flex-shrink: 0;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #2a5298;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        body.dark-mode input:checked + .toggle-slider {
            background-color: #4d8aff;
        }

        .user-section {
            padding: 25px 18px;
            border-top: 1px solid #eaeaea;
            background: #f8fafc;
            margin-top: auto;
            transition: background-color 0.3s, border-color 0.3s;
            flex-shrink: 0;
        }

        .sidebar.collapsed .user-section {
            padding: 25px 8px;
        }

        body.dark-mode .user-section {
            border-top: 1px solid #333;
            background: #2d2d2d;
        }

        .user-details {
            margin-bottom: 22px;
            transition: all 0.3s;
        }

        .sidebar.collapsed .user-details {
            display: none;
        }

        .user-name {
            font-weight: 600;
            font-size: 1.15rem;
            margin-bottom: 6px;
            color: #1e3c72;
            transition: color 0.3s;
        }

        body.dark-mode .user-name {
            color: #a3c4ff;
        }

        .user-role {
            font-size: 0.9rem;
            color: #666;
            background: #eef2f7;
            padding: 6px 12px;
            border-radius: 12px;
            display: inline-block;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-mode .user-role {
            background: #3a3a3a;
            color: #b0b0b0;
        }

        .user-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .sidebar.collapsed .user-actions {
            align-items: center;
        }

        .action-btn {
            background: white;
            color: #333;
            border: 1px solid #ddd;
            padding: 13px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: flex-start;
        }

        .sidebar.collapsed .action-btn {
            padding: 13px;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .sidebar.collapsed .action-btn span {
            display: none;
        }

        body.dark-mode .action-btn {
            background: #2d2d2d;
            color: #e0e0e0;
            border: 1px solid #444;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .action-btn:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .action-btn.profile {
            background: #e8f0ff;
            color: #2a5298;
            border-color: #c2d6ff;
        }

        body.dark-mode .action-btn.profile {
            background: #2a3a5a;
            color: #a3c4ff;
            border-color: #4d8aff;
        }

        .action-btn.logout {
            background: #ffeaea;
            color: #c62828;
            border-color: #ffcdd2;
        }

        body.dark-mode .action-btn.logout {
            background: #3a2a2a;
            color: #ff6b6b;
            border-color: #5a3a3a;
        }

        .main-content {
            flex: 1;
            margin-left: 300px;
            padding: 22px;
            overflow-x: hidden;
            transition: margin-left 0.3s ease;
        }

        .sidebar.collapsed ~ .main-content {
            margin-left: 70px;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            padding-bottom: 22px;
            border-bottom: 1px solid #eaeaea;
            transition: border-color 0.3s;
        }

        body.dark-mode .page-header {
            border-bottom: 1px solid #333;
        }

        .page-title {
            flex: 1;
        }

        .page-title h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2a5298;
            margin-bottom: 8px;
            transition: color 0.3s;
        }

        body.dark-mode .page-title h1 {
            color: #4d8aff;
        }

        .page-title .subtitle {
            font-size: 1rem;
            color: #666;
            transition: color 0.3s;
        }

        body.dark-mode .page-title .subtitle {
            color: #b0b0b0;
        }

        .time-controls {
            display: flex;
            gap: 12px;
            margin-top: 5px;
        }

        .time-filter-btn {
            background-color: #f0f5ff;
            color: #2a5298;
            border: 2px solid #c2d6ff;
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body.dark-mode .time-filter-btn {
            background-color: #2d3748;
            color: #a3c4ff;
            border-color: #4d8aff;
        }

        .time-filter-btn:hover {
            background-color: #e0eaff;
            transform: translateY(-2px);
        }

        body.dark-mode .time-filter-btn:hover {
            background-color: #3a4a6b;
        }

        .time-filter-btn.active {
            background-color: #2a5298;
            color: white;
            border-color: #2a5298;
        }

        body.dark-mode .time-filter-btn.active {
            background-color: #4d8aff;
            border-color: #4d8aff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .dashboard-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 22px;
            margin-bottom: 25px;
        }

        .summary-card {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
        }

        body.dark-mode .summary-card {
            background-color: #1e1e1e;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }

        .summary-card:hover {
            transform: translateY(-5px);
        }

        .summary-card.total {
            border-top: 5px solid #1e3c72;
        }

        body.dark-mode .summary-card.total {
            border-top: 5px solid #4d8aff;
        }

        .summary-card.transits {
            border-top: 5px solid #4CAF50;
        }

        body.dark-mode .summary-card.transits {
            border-top: 5px solid #66bb6a;
        }

        .summary-card.exonerated {
            border-top: 5px solid #FF9800;
        }

        body.dark-mode .summary-card.exonerated {
            border-top: 5px solid #ffb74d;
        }

        .summary-card.tag {
            border-top: 5px solid #9C27B0;
        }

        body.dark-mode .summary-card.tag {
            border-top: 5px solid #ba68c8;
        }

        .summary-title {
            font-size: 1rem;
            color: #666;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: color 0.3s;
            font-weight: bold;
        }

        body.dark-mode .summary-title {
            color: #b0b0b0;
        }

        .summary-value {
            font-size: 1.9rem;
            font-weight: 700;
            margin-bottom: 12px;
            transition: color 0.3s;
        }

        body.dark-mode .summary-value {
            color: #ffffff;
        }

        .summary-detail {
            font-size: 0.95rem;
            color: #777;
            transition: color 0.3s;
        }

        body.dark-mode .summary-detail {
            color: #a0a0a0;
        }

        .trend-container {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            transition: all 0.3s;
        }

        body.dark-mode .trend-container {
            background-color: #1e1e1e;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }

        .trend-container .card-title {
            font-size: 1.3rem;
            margin-bottom: 22px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: color 0.3s;
            font-weight: bold;
        }

        body.dark-mode .trend-container .card-title {
            color: #e0e0e0;
        }

        .dashboard-main {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 22px;
            margin-bottom: 25px;
        }

        .main-card {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
        }

        body.dark-mode .main-card {
            background-color: #1e1e1e;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }

        .card-title {
            font-size: 1.3rem;
            margin-bottom: 22px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: color 0.3s;
            font-weight: bold;
        }

        body.dark-mode .card-title {
            color: #e0e0e0;
        }

        .chart-container {
            height: 320px;
            position: relative;
        }

        .states-chart-container {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            transition: all 0.3s;
        }

        body.dark-mode .states-chart-container {
            background-color: #1e1e1e;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }

        .pie-charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 22px;
            margin-bottom: 25px;
        }

        .pie-chart-card {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
        }

        body.dark-mode .pie-chart-card {
            background-color: #1e1e1e;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }

        .export-section {
            display: flex;
            justify-content: flex-end;
            margin-top: 22px;
        }

        .export-btn {
            background-color: #2a5298;
            color: white;
            border: none;
            padding: 13px 25px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        body.dark-mode .export-btn {
            background-color: #4d8aff;
        }

        .export-btn:hover {
            background-color: #1e3c72;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 60, 114, 0.2);
        }

        body.dark-mode .export-btn:hover {
            background-color: #3a6bd6;
        }

        .filters-container {
            background-color: white;
            border-radius: 12px;
            padding: 22px;
            margin-bottom: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
        }

        body.dark-mode .filters-container {
            background-color: #1e1e1e;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }

        .filter-group {
            margin-bottom: 18px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        body.dark-mode .filter-group label {
            color: #b0b0b0;
        }

        .custom-select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #c2d6ff;
            border-radius: 8px;
            font-size: 0.95rem;
            background-color: #f0f5ff;
            color: #2a5298;
            cursor: pointer;
            transition: all 0.3s;
        }

        body.dark-mode .custom-select {
            background-color: #2d3748;
            color: #a3c4ff;
            border-color: #4d8aff;
        }

        .custom-select:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th {
            padding: 10px;
            text-align: center;
            border-bottom: 2px solid #c2d6ff;
            background-color: #f0f5ff;
            color: #2a5298;
            font-weight: 600;
        }

        body.dark-mode th {
            border-bottom: 2px solid #4d8aff;
            background-color: #2d3748;
            color: #a3c4ff;
        }

        td {
            padding: 10px;
            border-bottom: 1px solid #eaeaea;
            text-align: center;
        }

        body.dark-mode td {
            border-bottom: 1px solid #333;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        body.dark-mode tr:hover {
            background-color: #2d2d2d;
        }

        .horizontal-table {
            width: 100%;
            overflow-x: auto;
        }

        .horizontal-table th:first-child,
        .horizontal-table td:first-child {
            position: sticky;
            left: 0;
            background-color: #f0f5ff;
            z-index: 10;
            min-width: 160px;
            text-align: left;
            padding-left: 18px;
        }

        body.dark-mode .horizontal-table th:first-child,
        body.dark-mode .horizontal-table td:first-child {
            background-color: #2d3748;
        }

        .horizontal-table th {
            min-width: 110px;
            white-space: nowrap;
        }

        .total-row {
            background-color: #e8f0ff !important;
            font-weight: 600;
        }

        body.dark-mode .total-row {
            background-color: #2a3a5a !important;
        }

        .revenue-row {
            background-color: #f0f5ff !important;
            font-weight: 600;
            color: #2a5298;
        }

        body.dark-mode .revenue-row {
            background-color: #2d3748 !important;
            color: #a3c4ff;
        }

        .custom-select[multiple] {
            height: auto;
            min-height: 110px;
            padding: 8px 12px;
        }

        .custom-select[multiple] option {
            padding: 6px 10px;
            margin: 2px 0;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .custom-select[multiple] option:checked {
            background-color: #2a5298;
            color: white;
        }

        body.dark-mode .custom-select[multiple] option:checked {
            background-color: #4d8aff;
            color: white;
        }

        .custom-select[multiple] option:hover {
            background-color: #f0f5ff;
        }

        body.dark-mode .custom-select[multiple] option:hover {
            background-color: #2d3748;
        }

        .mapa-peaje-icon {
            position: absolute;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 5;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transform: translate(-50%, -50%);
        }

        .mapa-peaje-icon:hover {
            transform: translate(-50%, -50%) scale(1.2);
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .mapa-peaje-icon i {
            font-size: 16px;
        }

        .mapa-peaje-tooltip {
            position: absolute;
            background: white;
            color: #333;
            padding: 10px 14px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
            font-size: 0.9rem;
            z-index: 1000;
            pointer-events: none;
            transform: translate(-50%, -100%);
            margin-top: -10px;
            min-width: 160px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        body.dark-mode .mapa-peaje-tooltip {
            background: #2d2d2d;
            color: #e0e0e0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        .mapa-peaje-tooltip.active {
            opacity: 1;
        }

        .mapa-peaje-tooltip h4 {
            margin: 0 0 6px 0;
            color: #2a5298;
            font-size: 0.95rem;
        }

        body.dark-mode .mapa-peaje-tooltip h4 {
            color: #4d8aff;
        }

        .mapa-peaje-tooltip p {
            margin: 3px 0;
            font-size: 0.85rem;
        }

        #mapa-info-content div {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #eaeaea;
            transition: all 0.3s;
        }

        body.dark-mode #mapa-info-content div {
            background: #2d2d2d;
            border: 1px solid #444;
            color: #e0e0e0;
        }

        #mapa-info-content h4 {
            margin: 0 0 8px 0;
            color: #2a5298;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        body.dark-mode #mapa-info-content h4 {
            color: #4d8aff;
        }

        #mapa-info-content .valor {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin: 5px 0;
        }

        body.dark-mode #mapa-info-content .valor {
            color: #ffffff;
        }

        #mapa-info-content .detalle {
            font-size: 0.85rem;
            color: #666;
        }

        body.dark-mode #mapa-info-content .detalle {
            color: #b0b0b0;
        }

        /* Estilos específicos para el módulo ejecutivo */
        
        .periodo-info {
            font-size: 0.95rem;
            color: #666;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        body.dark-mode .periodo-info {
            color: #b0b0b0;
        }
        
        .periodo-info strong {
            color: #2a5298;
            font-weight: 600;
        }
        
        body.dark-mode .periodo-info strong {
            color: #4d8aff;
        }
        
        .ejecutivo-update-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .update-time {
            background: #f0f5ff;
            padding: 8px 18px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #2a5298;
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid #c2d6ff;
        }
        
        body.dark-mode .update-time {
            background: #2d3748;
            color: #a3c4ff;
            border-color: #4d8aff;
        }
        
        .summary-card.monitored {
            border-top: 5px solid #00BCD4;
        }
        
        body.dark-mode .summary-card.monitored {
            border-top: 5px solid #26c6da;
        }
        
        .percentage {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85rem;
        }
        
        .percentage.positive {
            background-color: rgba(76, 175, 80, 0.15);
            color: #2E7D32;
        }
        
        body.dark-mode .percentage.positive {
            background-color: rgba(102, 187, 106, 0.2);
            color: #66bb6a;
        }
        
        .percentage.negative {
            background-color: rgba(244, 67, 54, 0.15);
            color: #C62828;
        }
        
        body.dark-mode .percentage.negative {
            background-color: rgba(239, 83, 80, 0.2);
            color: #ef5350;
        }
        
        .top-peajes-container {
            overflow-x: auto;
        }
        
        .top-peajes-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .top-peajes-table th {
            padding: 12px 10px;
            text-align: left;
            border-bottom: 2px solid #c2d6ff;
            background-color: #f0f5ff;
            color: #2a5298;
            font-weight: 600;
            white-space: nowrap;
        }
        
        body.dark-mode .top-peajes-table th {
            border-bottom: 2px solid #4d8aff;
            background-color: #2d3748;
            color: #a3c4ff;
        }
        
        .top-peajes-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #eaeaea;
            text-align: left;
        }
        
        body.dark-mode .top-peajes-table td {
            border-bottom: 1px solid #333;
        }
        
        .top-peajes-table tr:hover {
            background-color: #f9f9f9;
        }
        
        body.dark-mode .top-peajes-table tr:hover {
            background-color: #2d2d2d;
        }
        
        .top-peajes-table tr:nth-child(1) {
            background-color: rgba(255, 193, 7, 0.1);
        }
        
        .top-peajes-table tr:nth-child(2) {
            background-color: rgba(158, 158, 158, 0.1);
        }
        
        .top-peajes-table tr:nth-child(3) {
            background-color: rgba(141, 110, 99, 0.1);
        }
        
        body.dark-mode .top-peajes-table tr:nth-child(1) {
            background-color: rgba(255, 193, 7, 0.15);
        }
        
        body.dark-mode .top-peajes-table tr:nth-child(2) {
            background-color: rgba(158, 158, 158, 0.15);
        }
        
        body.dark-mode .top-peajes-table tr:nth-child(3) {
            background-color: rgba(141, 110, 99, 0.15);
        }
        
        .top-peajes-info {
            margin-top: 18px;
            padding: 12px;
            background-color: #f0f5ff;
            border-radius: 8px;
            border-left: 4px solid #2a5298;
            font-size: 0.9rem;
            color: #555;
        }
        
        body.dark-mode .top-peajes-info {
            background-color: #2d3748;
            color: #b0b0b0;
            border-left: 4px solid #4d8aff;
        }
        
        .top-peajes-info i {
            color: #2a5298;
            margin-right: 6px;
        }
        
        body.dark-mode .top-peajes-info i {
            color: #4d8aff;
        }
        
        .alertas-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 360px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .alertas-container::-webkit-scrollbar {
            width: 5px;
        }
        
        .alertas-container::-webkit-scrollbar-thumb {
            background-color: rgba(42, 82, 152, 0.3);
            border-radius: 3px;
        }
        
        body.dark-mode .alertas-container::-webkit-scrollbar-thumb {
            background-color: rgba(77, 138, 255, 0.3);
        }
        
        .alerta-item {
            border-radius: 8px;
            padding: 18px;
            border-left: 4px solid;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
        }
        
        body.dark-mode .alerta-item {
            background-color: #1e1e1e;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .alerta-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }
        
        body.dark-mode .alerta-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .alerta-item.critica {
            border-left-color: #F44336;
        }
        
        .alerta-item.advertencia {
            border-left-color: #FF9800;
        }
        
        .alerta-item.informativa {
            border-left-color: #2196F3;
        }
        
        .alerta-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .alerta-header i {
            font-size: 18px;
        }
        
        .alerta-item.critica .alerta-header i {
            color: #F44336;
        }
        
        .alerta-item.advertencia .alerta-header i {
            color: #FF9800;
        }
        
        .alerta-item.informativa .alerta-header i {
            color: #2196F3;
        }
        
        .alerta-header h4 {
            font-size: 0.95rem;
            flex: 1;
            margin: 0;
            color: #333;
        }
        
        body.dark-mode .alerta-header h4 {
            color: #e0e0e0;
        }
        
        .alerta-tag {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .alerta-item.critica .alerta-tag {
            background-color: rgba(244, 67, 54, 0.15);
            color: #C62828;
        }
        
        .alerta-item.advertencia .alerta-tag {
            background-color: rgba(255, 152, 0, 0.15);
            color: #EF6C00;
        }
        
        .alerta-item.informativa .alerta-tag {
            background-color: rgba(33, 150, 243, 0.15);
            color: #1565C0;
        }
        
        body.dark-mode .alerta-item.critica .alerta-tag {
            background-color: rgba(244, 67, 54, 0.2);
        }
        
        body.dark-mode .alerta-item.advertencia .alerta-tag {
            background-color: rgba(255, 152, 0, 0.2);
        }
        
        body.dark-mode .alerta-item.informativa .alerta-tag {
            background-color: rgba(33, 150, 243, 0.2);
        }
        
        .alerta-item p {
            margin: 0 0 12px 0;
            color: #666;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        body.dark-mode .alerta-item p {
            color: #b0b0b0;
        }
        
        .alerta-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: #888;
        }
        
        body.dark-mode .alerta-footer {
            color: #a0a0a0;
        }
        
        .alerta-footer i {
            margin-right: 4px;
        }
        
        .alerta-btn {
            background-color: transparent;
            color: #2a5298;
            border: 1px solid #2a5298;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        body.dark-mode .alerta-btn {
            color: #4d8aff;
            border-color: #4d8aff;
        }
        
        .alerta-btn:hover {
            background-color: #2a5298;
            color: white;
        }
        
        body.dark-mode .alerta-btn:hover {
            background-color: #4d8aff;
            color: white;
        }

        /* Estilos para el módulo de usuarios */
        .user-link {
            color: #2a5298;
            cursor: pointer;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .user-link:hover {
            color: #1e3c72;
            text-decoration: underline;
        }
        
        body.dark-mode .user-link {
            color: #4d8aff;
        }
        
        body.dark-mode .user-link:hover {
            color: #a3c4ff;
        }
        
        /* Estilos mejorados para el estatus de usuarios */
        .status-active {
            color: #4CAF50;
            font-weight: 700;
            background-color: rgba(76, 175, 80, 0.15);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            min-width: 80px;
            text-align: center;
        }
        
        .status-inactive {
            color: #F44336;
            font-weight: 700;
            background-color: rgba(244, 67, 54, 0.15);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            min-width: 80px;
            text-align: center;
        }
        
        body.dark-mode .status-active {
            background-color: rgba(102, 187, 106, 0.2);
        }
        
        body.dark-mode .status-inactive {
            background-color: rgba(239, 83, 80, 0.2);
        }
        
        /* Estilos para modales en modo oscuro */
        body.dark-mode .modal > div {
            background-color: #1e1e1e;
            color: #e0e0e0;
            border: 1px solid #333;
        }
        
        body.dark-mode .modal h2 {
            color: #4d8aff;
        }
        
        body.dark-mode .modal .time-filter-btn {
            background-color: #2d3748;
            color: #a3c4ff;
            border-color: #4d8aff;
        }
        
        body.dark-mode .modal .time-filter-btn.active {
            background-color: #4d8aff;
            border-color: #4d8aff;
            color: white;
        }
        
        /* Nuevos estilos para campos de contraseña con icono de visualización */
        .password-input-container {
            position: relative;
        }
        
        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .password-toggle:hover {
            color: #2a5298;
        }
        
        body.dark-mode .password-toggle {
            color: #a0a0a0;
        }
        
        body.dark-mode .password-toggle:hover {
            color: #4d8aff;
        }
        
        /* Estilos para paginación */
        .pagination-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 2px solid #c2d6ff;
            background: #f0f5ff;
            color: #2a5298;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: #e0eaff;
            transform: translateY(-2px);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-number {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: #f0f5ff;
            color: #2a5298;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .page-number.active {
            background-color: #2a5298;
            color: white;
        }
        
        .page-number:hover:not(.active) {
            background: #e0eaff;
        }
        
        body.dark-mode .pagination-btn {
            background: #2d3748;
            color: #a3c4ff;
            border-color: #4d8aff;
        }
        
        body.dark-mode .page-number {
            background: #2d3748;
            color: #a3c4ff;
        }
        
        body.dark-mode .page-number.active {
            background-color: #4d8aff;
            color: white;
        }
        
        body.dark-mode .pagination-btn:hover:not(:disabled) {
            background: #3a4a6b;
        }
        
        body.dark-mode .page-number:hover:not(.active) {
            background: #3a4a6b;
        }
        
        /* Estilos para la confirmación de cierre de sesión */
        .confirmation-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2002;
            display: flex;
            justify-content: center;
            align-items: center;
            display: none;
        }
        
        .confirmation-modal.active {
            display: flex;
        }
        
        .confirmation-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        body.dark-mode .confirmation-content {
            background: #1e1e1e;
            border: 1px solid #333;
        }
        
        .confirmation-header {
            padding: 20px;
            border-bottom: 1px solid #eaeaea;
            background: #f0f5ff;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        body.dark-mode .confirmation-header {
            background: #2d3748;
            border-bottom: 1px solid #333;
        }
        
        .confirmation-header h3 {
            margin: 0;
            color: #2a5298;
            font-size: 1.2rem;
        }
        
        body.dark-mode .confirmation-header h3 {
            color: #4d8aff;
        }
        
        .confirmation-body {
            padding: 30px 20px;
            text-align: center;
        }
        
        .confirmation-body p {
            font-size: 1.1rem;
            margin-bottom: 30px;
            color: #333;
        }
        
        body.dark-mode .confirmation-body p {
            color: #e0e0e0;
        }
        
        .confirmation-footer {
            padding: 20px;
            border-top: 1px solid #eaeaea;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        body.dark-mode .confirmation-footer {
            border-top: 1px solid #333;
        }
        
        .confirmation-btn {
            padding: 10px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s;
            border: 2px solid;
            min-width: 120px;
        }
        
        .confirmation-btn.cancel {
            background: white;
            color: #666;
            border-color: #ddd;
        }
        
        .confirmation-btn.cancel:hover {
            background: #f5f5f5;
        }
        
        .confirmation-btn.confirm {
            background: #c62828;
            color: white;
            border-color: #c62828;
        }
        
        .confirmation-btn.confirm:hover {
            background: #b71c1c;
            border-color: #b71c1c;
        }
        
        body.dark-mode .confirmation-btn.cancel {
            background: #2d2d2d;
            color: #e0e0e0;
            border-color: #444;
        }
        
        body.dark-mode .confirmation-btn.cancel:hover {
            background: #3a3a3a;
        }
        
        body.dark-mode .confirmation-btn.confirm {
            background: #d32f2f;
            border-color: #d32f2f;
        }
        
        body.dark-mode .confirmation-btn.confirm:hover {
            background: #c62828;
            border-color: #c62828;
        }
        
        /* Estilos para módulo de perfil */
        #profile-modal .custom-select {
            padding-right: 40px;
        }
        
        /* Estilos para submenús del módulo de reportes */
        .submenu {
            display: none;
            padding-left: 25px;
            margin-top: 5px;
        }
        
        .module-item.has-submenu.active + .submenu {
            display: block;
        }
        
        .submenu .module-item {
            padding: 12px 25px;
            margin: 2px 12px;
            font-size: 0.9rem;
        }
        
        .sidebar.collapsed .submenu {
            display: none !important;
        }
        
        .module-item.has-submenu {
            position: relative;
        }
        
        .module-item.has-submenu::after {
            content: '\f078';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            right: 25px;
            transition: transform 0.3s;
        }
        
        .module-item.has-submenu.active::after {
            transform: rotate(180deg);
        }
        
        .sidebar.collapsed .module-item.has-submenu::after {
            display: none;
        }
        
        /* Estilos para modales de reportes */
        .report-header-info {
            background-color: white;
            border-radius: 12px;
            padding: 22px;
            margin-bottom: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        body.dark-mode .report-header-info {
            background-color: #1e1e1e;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }
        
        .report-header-info div {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .report-header-info strong {
            color: #2a5298;
            font-size: 1rem;
            min-width: 160px;
        }
        
        body.dark-mode .report-header-info strong {
            color: #4d8aff;
        }
        
        .report-header-info span {
            color: #666;
            font-size: 1rem;
        }
        
        body.dark-mode .report-header-info span {
            color: #b0b0b0;
        }
        
        /* Estilos para subtotal en tablas */
        .subtotal-row {
            background-color: #f0f5ff !important;
            font-weight: 600;
        }
        
        body.dark-mode .subtotal-row {
            background-color: #2d3748 !important;
        }
        
        /* Estilos para la tabla de reportes en card */
        .report-table-card {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            overflow-x: auto;
        }
        
        body.dark-mode .report-table-card {
            background-color: #1e1e1e;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }
        
        /* Estilos responsivos para el módulo de usuarios */
        @media (max-width: 992px) {
            .user-stats {
                flex-direction: column;
                align-items: flex-start;
            }
            
            #user-filters > div:first-child {
                grid-template-columns: 1fr;
            }
            
            .pagination {
                flex-direction: column;
                gap: 18px;
            }
        }
        
        @media (max-width: 768px) {
            #users-table {
                display: block;
                overflow-x: auto;
            }
            
            #users-table th,
            #users-table td {
                min-width: 110px;
            }
            
            #user-form-modal > div {
                width: 95%;
            }
            
            #user-form > div {
                grid-template-columns: 1fr;
            }
        }
        
        /* Responsive para el módulo ejecutivo */
        @media (max-width: 992px) {
            .ejecutivo-update-info {
                align-items: flex-start;
                margin-top: 12px;
            }
            
            .dashboard-summary {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-summary {
                grid-template-columns: 1fr;
            }
            
            .dashboard-main {
                grid-template-columns: 1fr;
            }
            
            .alerta-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }
            
            .alerta-footer {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .alerta-btn {
                align-self: flex-end;
            }
        }

        @media (max-width: 768px) {
            #mapa-nacional-container {
                height: 320px;
            }
            
            .mapa-peaje-icon {
                width: 28px;
                height: 28px;
                font-size: 12px;
            }
            
            .mapa-peaje-icon i {
                font-size: 12px;
            }
            
            #mapa-info-content {
                grid-template-columns: 1fr !important;
            }
        }

        @media (max-width: 1200px) {
            .dashboard-summary {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dashboard-main {
                grid-template-columns: 1fr;
            }
            
            .pie-charts-container {
                grid-template-columns: 1fr;
            }
            
            .filters-container > div {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar:not(.collapsed) {
                width: 300px;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .sidebar:not(.collapsed) ~ .main-content {
                margin-left: 300px;
            }
            
            .logo h2, .module-item span, .dark-mode-label, .user-details, .action-btn span {
                display: none;
            }
            
            .sidebar:not(.collapsed) .logo h2,
            .sidebar:not(.collapsed) .module-item span,
            .sidebar:not(.collapsed) .dark-mode-label,
            .sidebar:not(.collapsed) .user-details,
            .sidebar:not(.collapsed) .action-btn span {
                display: block;
            }
            
            .module-item {
                justify-content: center;
                padding: 18px;
                margin: 6px;
            }
            
            .sidebar:not(.collapsed) .module-item {
                justify-content: flex-start;
                padding: 18px 25px;
                margin: 6px 12px;
            }
            
            .module-item i {
                font-size: 1.2rem;
                width: auto;
            }
            
            .dark-mode-toggle {
                justify-content: center;
                padding: 22px 8px;
            }
            
            .sidebar:not(.collapsed) .dark-mode-toggle {
                justify-content: space-between;
                padding: 22px 18px;
            }
            
            .toggle-switch {
                margin: 0 auto;
            }
            
            .sidebar:not(.collapsed) .toggle-switch {
                margin: 0;
            }
            
            .user-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .sidebar:not(.collapsed) .user-actions {
                align-items: stretch;
            }
            
            .action-btn {
                padding: 13px;
                justify-content: center;
                width: 40px;
                height: 40px;
                border-radius: 50%;
            }
            
            .sidebar:not(.collapsed) .action-btn {
                width: auto;
                height: auto;
                border-radius: 8px;
                justify-content: flex-start;
            }
            
            .action-btn i {
                font-size: 18px;
                margin: 0;
            }
            
            .toggle-sidebar-btn {
                display: none;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 18px;
            }
            
            .time-controls {
                align-self: flex-start;
            }
        }

        @media (max-width: 768px) {
            .dashboard-summary {
                grid-template-columns: 1fr;
            }
            
            .export-section {
                justify-content: center;
            }
            
            .export-btn {
                width: 100%;
                justify-content: center;
            }
            
            .sidebar {
                width: 0;
                position: fixed;
                z-index: 1000;
                transition: width 0.3s;
            }
            
            .sidebar.active {
                width: 300px;
            }
            
            .sidebar.active .logo h2,
            .sidebar.active .module-item span,
            .sidebar.active .dark-mode-label,
            .sidebar.active .user-details,
            .sidebar.active .action-btn span {
                display: block;
            }
            
            .sidebar.active .module-item {
                justify-content: flex-start;
                padding: 18px 25px;
                margin: 6px 12px;
            }
            
            .sidebar.active .dark-mode-toggle {
                justify-content: space-between;
                padding: 22px 18px;
            }
            
            .sidebar.active .user-actions {
                align-items: stretch;
            }
            
            .sidebar.active .action-btn {
                width: auto;
                height: auto;
                border-radius: 8px;
                justify-content: flex-start;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
                position: fixed;
                top: 22px;
                left: 22px;
                z-index: 1001;
                background: #2a5298;
                color: white;
                border: none;
                width: 50px;
                height: 50px;
                border-radius: 50%;
                font-size: 20px;
                cursor: pointer;
                box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            }

            body.dark-mode .menu-toggle {
                background: #4d8aff;
            }
            
            .page-header {
                margin-top: 65px;
            }

            .horizontal-table {
                display: block;
                overflow-x: auto;
            }
        }

        .menu-toggle {
            display: none;
        }
        
        .sidebar.active {
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.15);
        }
        
        .module-item i, .action-btn i {
            transition: transform 0.3s;
        }
        
        .module-item:hover i, .action-btn:hover i {
            transform: scale(1.1);
        }
        
        /* Estilos para módulo de perfil */
        .profile-form-group {
            margin-bottom: 20px;
        }
        
        .profile-form-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        body.dark-mode .profile-form-group label {
            color: #b0b0b0;
        }

        /* Estilos para módulos de reportes */
        .report-presentation-card {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            margin-bottom: 25px;
        }
        
        body.dark-mode .report-presentation-card {
            background-color: #1e1e1e;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }
        
        .report-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2a5298;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        body.dark-mode .report-title {
            color: #4d8aff;
        }
        
        .report-description {
            font-size: 1rem;
            color: #666;
            line-height: 1.5;
        }
        
        body.dark-mode .report-description {
            color: #b0b0b0;
        }
        
        .report-form-container {
            display: block;
            margin-bottom: 25px;
        }
        
        .report-form-left {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            max-width: 800px;
        }
        
        body.dark-mode .report-form-left {
            background-color: #1e1e1e;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }
        
        .report-form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 18px;
            margin-bottom: 18px;
        }
        
        .report-form-full {
            grid-column: 1 / -1;
        }
        
        .generate-report-btn {
            background-color: #2a5298;
            color: white;
            border: none;
            padding: 13px 25px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 20px;
            align-self: flex-end;
        }
        
        body.dark-mode .generate-report-btn {
            background-color: #4d8aff;
        }
        
        .generate-report-btn:hover {
            background-color: #1e3c72;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 60, 114, 0.2);
        }
        
        body.dark-mode .generate-report-btn:hover {
            background-color: #3a6bd6;
        }
        
        .report-results-container {
            display: none;
            margin-top: 30px;
        }
        
        .report-results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaeaea;
        }
        
        body.dark-mode .report-results-header {
            border-bottom: 1px solid #333;
        }
        
        .report-results-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2a5298;
        }
        
        body.dark-mode .report-results-title {
            color: #4d8aff;
        }
        
        .report-actions-top {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            justify-content: flex-end;
        }
        
        .submenu .module-item i {
            display: none;
        }
        
        .submenu .module-item::before {
            display: none;
        }
        
        @media (max-width: 992px) {
            .report-form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar" id="sidebar">
        <div class="logo">
            <i class="fas fa-road fa-2x" style="color: #2a5298;"></i>
            <h2>DataVial</h2>
            <button class="toggle-sidebar-btn" id="toggleSidebar" title="Ocultar/Mostrar menú">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="menu-container">
            <nav class="menu-modules">
                <a href="#" class="module-item active" data-module="operativo">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Operativo</span>
                </a>
                <a href="#" class="module-item" data-module="operaciones">
                    <i class="fas fa-cogs"></i>
                    <span>Operaciones</span>
                </a>
                <a href="#" class="module-item" data-module="estrategico">
                    <i class="fas fa-chart-line"></i>
                    <span>Estratégico</span>
                </a>
                <a href="#" class="module-item" data-module="ejecutivo">
                    <i class="fas fa-users"></i>
                    <span>Ejecutivo</span>
                </a>
                <a href="#" class="module-item" data-module="usuarios">
                    <i class="fas fa-user-friends"></i>
                    <span>Usuarios</span>
                </a>
                <!-- Módulo de Reportes con submenú -->
                <div class="module-item has-submenu" data-module="reportes">
                    <i class="fas fa-file-alt"></i>
                    <span>Reportes</span>
                </div>
                <div class="submenu">
                    <a href="#" class="module-item" data-module="reporte1">
                        <span>• General</span>
                    </a>
                    <a href="#" class="module-item" data-module="reporte2">
                        <span>• Por Método de Pago</span>
                    </a>
                    <a href="#" class="module-item" data-module="reporte3">
                        <span>• Por Categoría de Vehículo</span>
                    </a>
                    <a href="#" class="module-item" data-module="reporte4">
                        <span>• Por Método de Pago y Categoría de Vehículo</span>
                    </a>
                </div>
            </nav>
            
            <div class="dark-mode-toggle">
                <span class="dark-mode-label">Modo Oscuro</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="darkModeToggle">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <div class="user-section">
                <div class="user-details">
                    <div class="user-name">Carlos Rodríguez</div>
                    <div class="user-role">Administrador</div>
                </div>
                
                <div class="user-actions">
                    <button class="action-btn profile" id="profileBtn">
                        <i class="fas fa-user-circle"></i>
                        <span>Perfil</span>
                    </button>
                    <button class="action-btn logout" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Cerrar Sesión</span>
                    </button>
                </div>
            </div>
        </div>
    </aside>
    
    <button class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <div class="main-content">
        <div id="module-operativo" class="module-container">
            <div class="container">
                <div class="page-header">
                    <div class="page-title">
                        <h1><i class="fas fa-tachometer-alt"></i> Panel Operativo</h1>
                        <p class="subtitle">Resumen de actividad de los peajes</p>
                    </div>
                    
                    <div class="time-controls">
                        <button class="time-filter-btn active" data-period="day">
                            <i class="fas fa-sun"></i> Día
                        </button>
                        <button class="time-filter-btn" data-period="month">
                            <i class="fas fa-calendar-alt"></i> Mes
                        </button>
                        <button class="time-filter-btn" data-period="year">
                            <i class="fas fa-chart-line"></i> Año
                        </button>
                    </div>
                </div>
                
                <div class="dashboard-summary">
                    <div class="summary-card total">
                        <div class="summary-title">
                            <i class="fas fa-money-bill-wave"></i> Recaudación Total
                        </div>
                        <div class="summary-value" id="total-revenue">Bs. 5.847.320,00</div>
                        <div class="summary-detail">Cantidad recaudada del tránsito de vehículos</div>
                    </div>
                    
                    <div class="summary-card transits">
                        <div class="summary-title">
                            <i class="fas fa-car"></i> Tránsitos Totales
                        </div>
                        <div class="summary-value" id="total-transits">142.850</div>
                        <div class="summary-detail">Total de vehículos que han circulado por los peajes</div>
                    </div>
                    
                    <div class="summary-card exonerated">
                        <div class="summary-title">
                            <i class="fas fa-car-on"></i> Tránsitos Exonerados
                        </div>
                        <div class="summary-value" id="exonerated-transits">8.571</div>
                        <div class="summary-detail" id="exonerated-detail">6,0% del total de tránsitos</div>
                    </div>
                    
                    <div class="summary-card tag">
                        <div class="summary-title">
                            <i class="fas fa-tag"></i> Tránsitos por Tag
                        </div>
                        <div class="summary-value" id="tag-transits">28.570</div>
                        <div class="summary-detail" id="tag-detail">20,0% del total de tránsitos</div>
                    </div>
                </div>
                
                <div class="trend-container">
                    <h2 class="card-title"><i class="fas fa-chart-line"></i> Recaudación y Tránsitos de Vehículos</h2>
                    <div class="chart-container">
                        <canvas id="trend-chart"></canvas>
                    </div>
                </div>
                
                <div class="states-chart-container">
                    <h2 class="card-title"><i class="fas fa-map"></i> Recaudación por Estado</h2>
                    <div class="chart-container">
                        <canvas id="states-chart"></canvas>
                    </div>
                </div>
                
                <div class="pie-charts-container">
                    <div class="pie-chart-card">
                        <h2 class="card-title"><i class="fas fa-chart-pie"></i> Recaudación por Categorías de Vehículos</h2>
                        <div class="chart-container">
                            <canvas id="vehicle-categories-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="pie-chart-card">
                        <h2 class="card-title"><i class="fas fa-credit-card"></i> Recaudación por Método de Pago</h2>
                        <div class="chart-container">
                            <canvas id="payment-methods-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="export-section">
                    <button class="export-btn" id="export-data">
                        <i class="fas fa-download"></i> Exportar Datos
                    </button>
                </div>
            </div>
        </div>

        <div id="module-operaciones" class="module-container" style="display: none;">
            <div class="container">
                <div class="page-header">
                    <div class="page-title">
                        <h1><i class="fas fa-cogs"></i> Panel de Operaciones</h1>
                        <p class="subtitle">Visualización de recaudación y tránsito de vehículos por peaje</p>
                    </div>
                    
                    <div class="time-controls">
                        <button class="time-filter-btn active" data-period="day">
                            <i class="fas fa-sun"></i> Día
                        </button>
                        <button class="time-filter-btn" data-period="month">
                            <i class="fas fa-calendar-alt"></i> Mes
                        </button>
                        <button class="time-filter-btn" data-period="year">
                            <i class="fas fa-chart-line"></i> Año
                        </button>
                    </div>
                </div>

                <div class="filters-container">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 18px;">
                        <div class="filter-group">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
                                <i class="fas fa-map-marker-alt"></i> Estado
                            </label>
                            <select id="estado-filter" class="custom-select">
                                <option value="carabobo">Carabobo</option>
                                <option value="zulia">Zulia</option>
                                <option value="miranda">Miranda</option>
                                <option value="aragua">Aragua</option>
                                <option value="lara">Lara</option>
                                <option value="bolivar">Bolívar</option>
                                <option value="tachira">Táchira</option>
                                <option value="merida">Mérida</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
                                <i class="fas fa-road"></i> Peaje
                            </label>
                            <select id="peaje-filter" class="custom-select" disabled>
                                <option value="">Seleccione un estado primero</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="trend-container">
                    <h2 class="card-title">
                        <i class="fas fa-chart-bar"></i> Recaudación por Método de Pago y Canal
                    </h2>
                    <div class="chart-container">
                        <canvas id="payment-channel-chart"></canvas>
                    </div>
                </div>

                <div class="trend-container" style="margin-top: 20px;">
                    <h2 class="card-title">
                        <i class="fas fa-car"></i> Tránsito de Vehículos por Categoría y Canal
                    </h2>
                    <div class="horizontal-table">
                        <table>
                            <thead id="channel-traffic-head">
                            </thead>
                            <tbody id="channel-traffic-body">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="export-section">
                    <button class="export-btn" id="export-operaciones-data">
                        <i class="fas fa-download"></i> Exportar Datos
                    </button>
                </div>
            </div>
        </div>

        <div id="module-estrategico" class="module-container" style="display: none;">
            <div class="container">
                <div class="page-header">
                    <div class="page-title">
                        <h1><i class="fas fa-chart-line"></i> Panel Estratégico</h1>
                        <p class="subtitle">Comparativa entre peajes nacionales</p>
                    </div>
                    
                    <div class="time-controls">
                        <button class="time-filter-btn active" data-period="day">
                            <i class="fas fa-sun"></i> Día
                        </button>
                        <button class="time-filter-btn" data-period="month">
                            <i class="fas fa-calendar-alt"></i> Mes
                        </button>
                        <button class="time-filter-btn" data-period="year">
                            <i class="fas fa-chart-line"></i> Año
                        </button>
                    </div>
                </div>

                <div class="filters-container">
                    <div style="display: grid; grid-template-columns: 1fr; gap: 18px;">
                        <div class="filter-group">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
                                <i class="fas fa-map-marker-alt"></i> Estado
                            </label>
                            <select id="estrategico-estado-filter" class="custom-select" multiple>
                                <option value="all" selected>Todos los estados</option>
                                <option value="carabobo">Carabobo</option>
                                <option value="zulia">Zulia</option>
                                <option value="miranda">Miranda</option>
                                <option value="aragua">Aragua</option>
                                <option value="lara">Lara</option>
                                <option value="bolivar">Bolívar</option>
                                <option value="tachira">Táchira</option>
                                <option value="merida">Mérida</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="dashboard-summary">
                    <div class="summary-card total">
                        <div class="summary-title">
                            <i class="fas fa-money-bill-wave"></i> Recaudación Total
                        </div>
                        <div class="summary-value" id="estrategico-total-revenue">Bs. 0</div>
                        <div class="summary-detail">Suma de recaudación</div>
                    </div>
                    
                    <div class="summary-card transits">
                        <div class="summary-title">
                            <i class="fas fa-car"></i> Tránsito Total
                        </div>
                        <div class="summary-value" id="estrategico-total-transits">0</div>
                        <div class="summary-detail">Suma de tránsitos</div>
                    </div>
                    
                    <div class="summary-card exonerated">
                        <div class="summary-title">
                            <i class="fas fa-map-marked-alt"></i> Estado con Mayor Recaudación
                        </div>
                        <div class="summary-value" id="estrategico-top-state">-</div>
                        <div class="summary-detail" id="estrategico-top-state-detail"></div>
                    </div>
                    
                    <div class="summary-card tag">
                        <div class="summary-title">
                            <i class="fas fa-road"></i> Peaje con Mayor Recaudación
                        </div>
                        <div class="summary-value" id="estrategico-top-toll">-</div>
                        <div class="summary-detail" id="estrategico-top-toll-detail"></div>
                    </div>
                </div>

                <div class="trend-container">
                    <h2 class="card-title"><i class="fas fa-list-ol"></i> Distribución por Estado</h2>
                    <div class="horizontal-table">
                        <table>
                            <thead>
                                <tr>
                                    <th style="text-align: center;">Nro.</th>
                                    <th>Estado</th>
                                    <th>Recaudación (Bs.)</th>
                                    <th>Tránsito</th>
                                    <th>% del Total Recaudación</th>
                                    <th>Peajes</th>
                                </tr>
                            </thead>
                            <tbody id="estrategico-distribucion-body">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="dashboard-main">
                    <div class="main-card">
                        <h2 class="card-title"><i class="fas fa-money-bill-wave"></i> Recaudación por Peaje</h2>
                        <div class="chart-container">
                            <canvas id="estrategico-recaudacion-peaje-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="main-card">
                        <h2 class="card-title"><i class="fas fa-car"></i> Tránsito por Peaje</h2>
                        <div class="chart-container">
                            <canvas id="estrategico-transito-peaje-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="trend-container">
                    <h2 class="card-title"><i class="fas fa-map"></i> Mapa Nacional de Peajes</h2>
                    <div id="mapa-nacional-container" style="position: relative; height: 450px; background: #f8fafc; border-radius: 8px; overflow: hidden;">
                        <div id="mapa-nacional" style="width: 100%; height: 100%; position: relative;">
                            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;">
                                <svg width="90%" height="90%" viewBox="0 0 800 600" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                    <g id="mapa-venezuela">
                                        <path id="venezuela" d="M200,100 L250,120 L300,150 L350,200 L400,250 L450,300 L500,350 L550,400 L600,450 L650,500 L700,550 L750,500 L800,450 L850,400 L900,350 L950,300 L1000,250 L1050,200 L1100,150 L1150,120 L1200,100 L1250,150 L1300,200 L1350,250 L1400,300 L1450,350 L1500,400 L1550,450 L1600,500 L1550,550 L1500,600 L1450,550 L1400,500 L1350,450 L1300,400 L1250,350 L1200,300 L1150,250 L1100,200 L1050,150 L1000,100 L950,50 L900,100 L850,150 L800,200 L750,250 L700,300 L650,350 L600,400 L550,450 L500,500 L450,550 L400,600 L350,550 L300,500 L250,450 L200,400 L150,350 L100,300 L50,250 L100,200 L150,150 Z" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
                                    </g>
                                </svg>
                            </div>
                        </div>
                        
                        <div id="mapa-contador" style="position: absolute; top: 18px; left: 18px; background: rgba(42, 82, 152, 0.9); color: white; padding: 8px 18px; border-radius: 20px; font-weight: 600; z-index: 10;">
                            <i class="fas fa-road"></i> <span id="contador-peajes">0</span> peajes mostrados
                        </div>
                    </div>
                    
                    <div id="mapa-info" style="display: none; margin-top: 18px; padding: 18px; background: #f0f5ff; border-radius: 8px; border-left: 4px solid #2a5298;">
                        <h3 style="margin-bottom: 12px; color: #2a5298; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-info-circle"></i> Información del Peaje
                        </h3>
                        <div id="mapa-info-content" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                        </div>
                    </div>
                </div>

                <div class="export-section">
                    <button class="export-btn" id="export-estrategico-data">
                        <i class="fas fa-download"></i> Exportar Datos
                    </button>
                </div>
            </div>
        </div>

        <div id="module-ejecutivo" class="module-container" style="display: none;">
            <div class="container">
                <div class="page-header">
                    <div class="page-title">
                        <h1><i class="fas fa-users"></i> Resumen Ejecutivo Nacional</h1>
                        <p class="subtitle">Informe estratégico para toma de decisiones - Últimos 30 días</p>
                        <p class="periodo-info">Período: <strong>23/12/2025 - 22/1/2026</strong></p>
                    </div>
                    
                    <div class="ejecutivo-update-info">
                        <div class="update-time">
                            <i class="fas fa-clock"></i> Actualizado: <span id="current-date-time"></span>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-summary">
                    <div class="summary-card total">
                        <div class="summary-title">
                            <i class="fas fa-money-bill-wave"></i> Recaudación Total
                        </div>
                        <div class="summary-value" id="ejecutivo-total-revenue">Bs. 158.473.200,00</div>
                        <div class="summary-detail">
                            <span class="percentage positive"><i class="fas fa-arrow-up"></i> 8,2%</span> vs mes anterior
                        </div>
                    </div>
                    
                    <div class="summary-card transits">
                        <div class="summary-title">
                            <i class="fas fa-car"></i> Tránsito Total
                        </div>
                        <div class="summary-value" id="ejecutivo-total-transits">4.285.500</div>
                        <div class="summary-detail">
                            <span class="percentage positive"><i class="fas fa-arrow-up"></i> 3,5%</span> vs mes anterior
                        </div>
                    </div>
                    
                    <div class="summary-card exonerated">
                        <div class="summary-title">
                            <i class="fas fa-car-on"></i> Tránsitos Exonerados
                        </div>
                        <div class="summary-value" id="ejecutivo-exonerated-transits">257.130</div>
                        <div class="summary-detail">
                            <span class="percentage negative"><i class="fas fa-arrow-down"></i> 1,8%</span> vs mes anterior
                        </div>
                    </div>
                    
                    <div class="summary-card tag">
                        <div class="summary-title">
                            <i class="fas fa-tag"></i> Tránsitos por Tag
                        </div>
                        <div class="summary-value" id="ejecutivo-tag-transits">857.100</div>
                        <div class="summary-detail">
                            <span class="percentage positive"><i class="fas fa-arrow-up"></i> 12,5%</span> vs mes anterior
                        </div>
                    </div>
                </div>
                
                <div class="trend-container">
                    <h2 class="card-title"><i class="fas fa-chart-line"></i> Tendencia Mensual de Recaudación y Tránsito</h2>
                    <div class="chart-container">
                        <canvas id="ejecutivo-trend-chart"></canvas>
                    </div>
                </div>
                
                <div class="dashboard-main">
                    <div class="main-card">
                        <h2 class="card-title"><i class="fas fa-trophy"></i> Top 3 Peajes por Recaudación</h2>
                        <div class="top-peajes-container">
                            <table class="top-peajes-table">
                                <thead>
                                    <tr>
                                        <th>Posición</th>
                                        <th>Peaje</th>
                                        <th>Estado</th>
                                        <th>Recaudación (Bs.)</th>
                                        <th>Tránsito</th>
                                    </tr>
                                </thead>
                                <tbody id="top-peajes-body">
                                    <!-- Los datos se llenarán con JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div class="top-peajes-info" id="top-peajes-info">
                            <!-- Información de total de peajes y estados se llenará con JavaScript -->
                        </div>
                    </div>
                    
                    <div class="main-card">
                        <h2 class="card-title"><i class="fas fa-exclamation-triangle"></i> Alertas Estratégicas</h2>
                        <div class="alertas-container">
                            <div class="alerta-item critica">
                                <div class="alerta-header">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <h4>Alta Recaudación en Peaje Caracas</h4>
                                    <span class="alerta-tag">Crítica</span>
                                </div>
                                <p>El peaje Caracas superó el límite de recaudación diario en un 15%. Revisar capacidad operativa.</p>
                                <div class="alerta-footer">
                                    <span><i class="fas fa-clock"></i> Detectada hoy a las 14:30</span>
                                    <button class="alerta-btn">Ver Detalle</button>
                                </div>
                            </div>
                            
                            <div class="alerta-item advertencia">
                                <div class="alerta-header">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <h4>Caída en Tránsito - Estado Bolívar</h4>
                                    <span class="alerta-tag">Advertencia</span>
                                </div>
                                <p>Reducción del 8% en tránsito en el estado Bolívar durante la última semana.</p>
                                <div class="alerta-footer">
                                    <span><i class="fas fa-clock"></i> Detectada hace 2 días</span>
                                    <button class="alerta-btn">Ver Detalle</button>
                                </div>
                            </div>
                            
                            <div class="alerta-item informativa">
                                <div class="alerta-header">
                                    <i class="fas fa-info-circle"></i>
                                    <h4>Incremento en Pagos Digitales</h4>
                                    <span class="alerta-tag">Informativa</span>
                                </div>
                                <p>Los pagos digitales (Tag + Pago móvil) aumentaron un 5% este mes.</p>
                                <div class="alerta-footer">
                                    <span><i class="fas fa-clock"></i> Actualizada ayer</span>
                                    <button class="alerta-btn">Ver Detalle</button>
                                </div>
                            </div>
                            
                            <div class="alerta-item informativa">
                                <div class="alerta-header">
                                    <i class="fas fa-info-circle"></i>
                                    <h4>Estado Mérida - Bajo Desempeño</h4>
                                    <span class="alerta-tag">Informativa</span>
                                </div>
                                <p>Recaudación 12% por debajo del promedio nacional en el estado Mérida.</p>
                                <div class="alerta-footer">
                                    <span><i class="fas fa-clock"></i> Actualizada hace 3 días</span>
                                    <button class="alerta-btn">Ver Detalle</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="export-section">
                    <button class="export-btn" id="export-ejecutivo-data">
                        <i class="fas fa-download"></i> Exportar Datos
                    </button>
                </div>
            </div>
        </div>

        <div id="module-usuarios" class="module-container" style="display: none;">
            <div class="container">
                <div class="page-header">
                    <div class="page-title">
                        <h1><i class="fas fa-user-friends"></i> Gestión de Usuarios</h1>
                        <p class="subtitle">Lista de usuarios registrados en el sistema</p>
                    </div>
                    
                    <div class="time-controls">
                        <button class="time-filter-btn" id="filter-btn">
                            <i class="fas fa-filter"></i> Filtro
                        </button>
                        <button class="time-filter-btn" id="create-user-btn">
                            <i class="fas fa-plus-circle"></i> Crear
                        </button>
                    </div>
                </div>

                <div class="filters-container" id="user-filters" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr; gap: 18px;">
                        <div class="filter-group">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
                                <i class="fas fa-search"></i> Buscar
                            </label>
                            <input type="text" id="search-user" class="custom-select" placeholder="Buscar por usuario, nombre, apellido o cédula...">
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 18px;">
                        <button class="time-filter-btn" id="clear-filters-btn">
                            <i class="fas fa-times"></i> Limpiar filtros
                        </button>
                        <button class="time-filter-btn active" id="apply-filters-btn">
                            <i class="fas fa-check"></i> Aplicar filtros
                        </button>
                    </div>
                </div>

                <div class="trend-container">
                    <div class="horizontal-table">
                        <table id="users-table">
                            <thead>
                                <tr>
                                    <th style="text-align: center;">Usuario</th>
                                    <th style="text-align: center;">Nombre</th>
                                    <th style="text-align: center;">Apellido</th>
                                    <th style="text-align: center;">Cédula</th>
                                    <th style="text-align: center;">Rol</th>
                                    <th style="text-align: center;">Estatus</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <!-- Los usuarios se cargarán aquí con JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination" style="display: flex; justify-content: space-between; align-items: center; margin-top: 22px; padding-top: 18px; border-top: 1px solid #eaeaea;">
                        <div style="color: #666; font-size: 0.9rem;">
                            Mostrando <span id="current-page-start">1</span>-<span id="current-page-end">10</span> de <span id="total-users">11</span> usuarios
                        </div>
                        
                        <div style="display: flex; gap: 6px;">
                            <button class="pagination-btn" id="first-page-btn" title="Primera página">
                                <i class="fas fa-angle-double-left"></i>
                            </button>
                            <button class="pagination-btn" id="prev-page-btn" title="Página anterior">
                                <i class="fas fa-angle-left"></i>
                            </button>
                            
                            <div style="display: flex; gap: 4px;" id="pagination-numbers">
                                <!-- Los números de página se generarán aquí -->
                            </div>
                            
                            <button class="pagination-btn" id="next-page-btn" title="Página siguiente">
                                <i class="fas fa-angle-right"></i>
                            </button>
                            <button class="pagination-btn" id="last-page-btn" title="Última página">
                                <i class="fas fa-angle-double-right"></i>
                            </button>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 0.9rem; color: #666;">Mostrar:</span>
                            <select id="users-per-page" class="custom-select" style="width: auto; padding: 6px 12px;">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Modal para crear/editar usuario -->
                <div id="user-form-modal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 2001; justify-content: center; align-items: center;">
                    <div style="background: white; border-radius: 12px; width: 90%; max-width: 650px; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 22px; border-bottom: 1px solid #eaeaea;">
                            <h2 style="margin: 0; color: #2a5298; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-user-plus"></i> <span id="form-modal-title">Crear Nuevo Usuario</span>
                            </h2>
                            <button id="close-form-modal-btn" style="background: none; border: none; font-size: 22px; color: #666; cursor: pointer; transition: color 0.3s;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <form id="user-form" style="padding: 22px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-bottom: 18px;">
                                <div class="filter-group">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
                                        <i class="fas fa-user"></i> Nombre *
                                    </label>
                                    <input type="text" id="form-firstname" class="custom-select" required>
                                </div>
                                
                                <div class="filter-group">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
                                        <i class="fas fa-user"></i> Apellido *
                                    </label>
                                    <input type="text" id="form-lastname" class="custom-select" required>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-bottom: 18px;">
                                <div class="filter-group">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
                                        <i class="fas fa-id-card"></i> Cédula *
                                    </label>
                                    <input type="text" id="form-cedula" class="custom-select" required>
                                </div>
                                
                                <div class="filter-group">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
                                        <i class="fas fa-user-tag"></i> Usuario *
                                    </label>
                                    <input type="text" id="form-username" class="custom-select" required>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-bottom: 18px;">
                                <div class="filter-group">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
                                        <i class="fas fa-user-tag"></i> Rol *
                                    </label>
                                    <select id="form-role" class="custom-select" required>
                                        <option value="">Seleccione un rol</option>
                                        <option value="administrador">Administrador</option>
                                        <option value="visualizador">Visualizador</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
                                        <i class="fas fa-check-circle"></i> Estatus *
                                    </label>
                                    <select id="form-status" class="custom-select" required>
                                        <option value="activo" selected>Activo</option>
                                        <option value="inactivo">Inactivo</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-bottom: 18px;">
                                <div class="filter-group">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
                                        <i class="fas fa-lock"></i> Contraseña
                                    </label>
                                    <div class="password-input-container">
                                        <input type="password" id="form-password" class="custom-select" placeholder="Contraseña *" required>
                                        <button type="button" class="password-toggle" id="toggle-password">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="filter-group">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">
                                        <i class="fas fa-lock"></i> Confirmar Contraseña
                                    </label>
                                    <div class="password-input-container">
                                        <input type="password" id="form-confirm-password" class="custom-select" placeholder="Confirmar Contraseña *" required>
                                        <button type="button" class="password-toggle" id="toggle-confirm-password">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <input type="hidden" id="form-user-id">
                        </form>
                        
                        <div style="display: flex; justify-content: flex-end; gap: 12px; padding: 18px 22px; border-top: 1px solid #eaeaea;">
                            <button type="button" class="time-filter-btn" id="cancel-form-btn">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button type="submit" form="user-form" class="time-filter-btn active" id="save-user-btn">
                                <i class="fas fa-save"></i> Guardar Usuario
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Botón Exportar Datos en esquina inferior derecha -->
                <div class="export-section" style="position: fixed; bottom: 25px; right: 25px; z-index: 1000;">
                    <button class="export-btn" id="export-usuarios-data">
                        <i class="fas fa-download"></i> Exportar Datos
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Módulo de Reportes (vacíos por ahora) -->
        <div id="module-reportes" class="module-container" style="display: none;">
            <div class="container">
                <div class="page-header">
                    <div class="page-title">
                        <h1><i class="fas fa-file-alt"></i> Módulo de Reportes</h1>
                        <p class="subtitle">Seleccione un tipo de reporte del menú lateral</p>
                    </div>
                </div>
                <div style="text-align: center; padding: 50px; color: #666;">
                    <i class="fas fa-file-alt fa-4x" style="margin-bottom: 20px; opacity: 0.5;"></i>
                    <h3>Seleccione un tipo de reporte del menú lateral</h3>
                </div>
            </div>
        </div>

        <!-- Reporte 1: Recaudación General -->
        <div id="module-reporte1" class="module-container" style="display: none;">
            <div class="container">
                <div class="page-header">
                    <div class="page-title">
                        <h1><i class="fas fa-file-alt"></i> Reporte de Recaudación General</h1>
                        <p class="subtitle">Reporte que refleja la recaudación general de los peajes por cantidad de vehículos</p>
                    </div>
                </div>
                
                <div class="report-form-container">
                    <div class="report-form-left">
                        <div style="margin-bottom: 18px;">
                            <div class="report-form-grid">
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-calendar-day"></i> Fecha de inicio *
                                    </label>
                                    <input type="date" id="reporte1-fecha-inicio" class="custom-select" required>
                                </div>
                                
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-calendar-day"></i> Fecha de fin *
                                    </label>
                                    <input type="date" id="reporte1-fecha-fin" class="custom-select" required>
                                </div>
                                
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-clock"></i> Hora de inicio
                                    </label>
                                    <input type="time" id="reporte1-hora-inicio" class="custom-select">
                                </div>
                                
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-clock"></i> Hora de fin
                                    </label>
                                    <input type="time" id="reporte1-hora-fin" class="custom-select">
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-map-marker-alt"></i> Estado
                                    </label>
                                    <select id="reporte1-estado" class="custom-select" multiple>
                                        <option value="all" selected>Todos</option>
                                        <option value="carabobo">Carabobo</option>
                                        <option value="zulia">Zulia</option>
                                        <option value="miranda">Miranda</option>
                                        <option value="aragua">Aragua</option>
                                        <option value="lara">Lara</option>
                                        <option value="bolivar">Bolívar</option>
                                        <option value="tachira">Táchira</option>
                                        <option value="merida">Mérida</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-road"></i> Peaje
                                    </label>
                                    <select id="reporte1-peaje" class="custom-select" multiple>
                                        <option value="all" selected>Todos</option>
                                        <option value="valencia">Peaje Valencia</option>
                                        <option value="maracaibo">Peaje Maracaibo</option>
                                        <option value="caracas">Peaje Caracas</option>
                                        <option value="maracay">Peaje Maracay</option>
                                        <option value="barquisimeto">Peaje Barquisimeto</option>
                                        <option value="ciudadbolivar">Peaje Ciudad Bolívar</option>
                                        <option value="sanantonio">Peaje San Antonio</option>
                                        <option value="merida">Peaje Mérida</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-chart-bar"></i> Agrupación *
                                    </label>
                                    <select id="reporte1-agrupacion" class="custom-select" required>
                                        <option value="diario">Diario</option>
                                        <option value="mensual">Mensual</option>
                                        <option value="anual">Anual</option>
                                    </select>
                                </div>
                            </div>
                            
                            <button class="generate-report-btn" id="generar-reporte1">
                                <i class="fas fa-chart-bar"></i> Generar Reporte
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="report-results-container" id="reporte1-resultados">
                    <div class="report-actions-top">
                        <button class="export-btn" id="volver-reporte1">
                            <i class="fas fa-arrow-left"></i> Volver al Formulario
                        </button>
                        <button class="export-btn" id="descargar-excel-reporte1">
                            <i class="fas fa-file-excel"></i> Descargar Excel
                        </button>
                        <button class="export-btn" id="descargar-pdf-reporte1">
                            <i class="fas fa-file-pdf"></i> Descargar PDF
                        </button>
                    </div>
                    
                    <div class="report-header-info">
                        <div>
                            <strong>Fecha de solicitud:</strong>
                            <span id="reporte1-fecha-solicitud"></span>
                        </div>
                        <div>
                            <strong>Solicitado por:</strong>
                            <span id="reporte1-solicitado-por">Carlos Rodríguez</span>
                        </div>
                    </div>
                    
                    <div class="report-table-card">
                        <div class="horizontal-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Estado</th>
                                        <th>Peaje</th>
                                        <th>Vehículos</th>
                                        <th>Recaudación (Bs.)</th>
                                    </tr>
                                </thead>
                                <tbody id="reporte1-tabla-body">
                                    <!-- Los datos se llenarán con JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reporte 2: Recaudación por Método de Pago -->
        <div id="module-reporte2" class="module-container" style="display: none;">
            <div class="container">
                <div class="page-header">
                    <div class="page-title">
                        <h1><i class="fas fa-file-alt"></i> Reporte de Recaudación por Método de Pago</h1>
                        <p class="subtitle">Reporte que refleja la recaudación de los peajes por cantidad de vehículos y método de pago</p>
                    </div>
                </div>
                
                <div class="report-form-container">
                    <div class="report-form-left">
                        <div style="margin-bottom: 18px;">
                            <div class="report-form-grid">
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-calendar-day"></i> Fecha de inicio *
                                    </label>
                                    <input type="date" id="reporte2-fecha-inicio" class="custom-select" required>
                                </div>
                                
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-calendar-day"></i> Fecha de fin *
                                    </label>
                                    <input type="date" id="reporte2-fecha-fin" class="custom-select" required>
                                </div>
                                
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-clock"></i> Hora de inicio
                                    </label>
                                    <input type="time" id="reporte2-hora-inicio" class="custom-select">
                                </div>
                                
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-clock"></i> Hora de fin
                                    </label>
                                    <input type="time" id="reporte2-hora-fin" class="custom-select">
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-map-marker-alt"></i> Estado
                                    </label>
                                    <select id="reporte2-estado" class="custom-select" multiple>
                                        <option value="all" selected>Todos</option>
                                        <option value="carabobo">Carabobo</option>
                                        <option value="zulia">Zulia</option>
                                        <option value="miranda">Miranda</option>
                                        <option value="aragua">Aragua</option>
                                        <option value="lara">Lara</option>
                                        <option value="bolivar">Bolívar</option>
                                        <option value="tachira">Táchira</option>
                                        <option value="merida">Mérida</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-road"></i> Peaje
                                    </label>
                                    <select id="reporte2-peaje" class="custom-select" multiple>
                                        <option value="all" selected>Todos</option>
                                        <option value="valencia">Peaje Valencia</option>
                                        <option value="maracaibo">Peaje Maracaibo</option>
                                        <option value="caracas">Peaje Caracas</option>
                                        <option value="maracay">Peaje Maracay</option>
                                        <option value="barquisimeto">Peaje Barquisimeto</option>
                                        <option value="ciudadbolivar">Peaje Ciudad Bolívar</option>
                                        <option value="sanantonio">Peaje San Antonio</option>
                                        <option value="merida">Peaje Mérida</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-credit-card"></i> Método de Pago
                                    </label>
                                    <select id="reporte2-metodo-pago" class="custom-select" multiple>
                                        <option value="all" selected>Todos</option>
                                        <option value="efectivo">Efectivo</option>
                                        <option value="pago-movil">Pago Móvil</option>
                                        <option value="tarjeta-debito">Tarjeta de Débito</option>
                                        <option value="tarjeta-credito">Tarjeta de Crédito</option>
                                        <option value="tag">Tag</option>
                                        <option value="transferencia">Transferencia</option>
                                        <option value="billetera-digital">Billetera Digital</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-chart-bar"></i> Agrupación *
                                    </label>
                                    <select id="reporte2-agrupacion" class="custom-select" required>
                                        <option value="diario">Diario</option>
                                        <option value="mensual">Mensual</option>
                                        <option value="anual">Anual</option>
                                    </select>
                                </div>
                            </div>
                            
                            <button class="generate-report-btn" id="generar-reporte2">
                                <i class="fas fa-chart-bar"></i> Generar Reporte
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="report-results-container" id="reporte2-resultados">
                    <div class="report-actions-top">
                        <button class="export-btn" id="volver-reporte2">
                            <i class="fas fa-arrow-left"></i> Volver al Formulario
                        </button>
                        <button class="export-btn" id="descargar-excel-reporte2">
                            <i class="fas fa-file-excel"></i> Descargar Excel
                        </button>
                        <button class="export-btn" id="descargar-pdf-reporte2">
                            <i class="fas fa-file-pdf"></i> Descargar PDF
                        </button>
                    </div>
                    
                    <div class="report-header-info">
                        <div>
                            <strong>Fecha de solicitud:</strong>
                            <span id="reporte2-fecha-solicitud"></span>
                        </div>
                        <div>
                            <strong>Solicitado por:</strong>
                            <span id="reporte2-solicitado-por">Carlos Rodríguez</span>
                        </div>
                    </div>
                    
                    <div class="report-table-card">
                        <div class="horizontal-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Estado</th>
                                        <th>Peaje</th>
                                        <th>Método de Pago</th>
                                        <th>Vehículos</th>
                                        <th>Recaudación (Bs.)</th>
                                    </tr>
                                </thead>
                                <tbody id="reporte2-tabla-body">
                                    <!-- Los datos se llenarán con JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reporte 3: Recaudación por Categoría de Vehículos -->
        <div id="module-reporte3" class="module-container" style="display: none;">
            <div class="container">
                <div class="page-header">
                    <div class="page-title">
                        <h1><i class="fas fa-file-alt"></i> Reporte de Recaudación por Categoría de Vehículos</h1>
                        <p class="subtitle">Reporte que refleja la recaudación de los peajes por cantidad de vehículos y categoría</p>
                    </div>
                </div>
                
                <div class="report-form-container">
                    <div class="report-form-left">
                        <div style="margin-bottom: 18px;">
                            <div class="report-form-grid">
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-calendar-day"></i> Fecha de inicio *
                                    </label>
                                    <input type="date" id="reporte3-fecha-inicio" class="custom-select" required>
                                </div>
                                
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-calendar-day"></i> Fecha de fin *
                                    </label>
                                    <input type="date" id="reporte3-fecha-fin" class="custom-select" required>
                                </div>
                                
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-clock"></i> Hora de inicio
                                    </label>
                                    <input type="time" id="reporte3-hora-inicio" class="custom-select">
                                </div>
                                
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-clock"></i> Hora de fin
                                    </label>
                                    <input type="time" id="reporte3-hora-fin" class="custom-select">
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-map-marker-alt"></i> Estado
                                    </label>
                                    <select id="reporte3-estado" class="custom-select" multiple>
                                        <option value="all" selected>Todos</option>
                                        <option value="carabobo">Carabobo</option>
                                        <option value="zulia">Zulia</option>
                                        <option value="miranda">Miranda</option>
                                        <option value="aragua">Aragua</option>
                                        <option value="lara">Lara</option>
                                        <option value="bolivar">Bolívar</option>
                                        <option value="tachira">Táchira</option>
                                        <option value="merida">Mérida</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-road"></i> Peaje
                                    </label>
                                    <select id="reporte3-peaje" class="custom-select" multiple>
                                        <option value="all" selected>Todos</option>
                                        <option value="valencia">Peaje Valencia</option>
                                        <option value="maracaibo">Peaje Maracaibo</option>
                                        <option value="caracas">Peaje Caracas</option>
                                        <option value="maracay">Peaje Maracay</option>
                                        <option value="barquisimeto">Peaje Barquisimeto</option>
                                        <option value="ciudadbolivar">Peaje Ciudad Bolívar</option>
                                        <option value="sanantonio">Peaje San Antonio</option>
                                        <option value="merida">Peaje Mérida</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-car"></i> Categoría de Vehículo
                                    </label>
                                    <select id="reporte3-categoria" class="custom-select" multiple>
                                        <option value="all" selected>Todos</option>
                                        <option value="livianos">Livianos</option>
                                        <option value="pesados">Pesados</option>
                                        <option value="motocicletas">Motocicletas</option>
                                        <option value="especiales">Especiales</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-chart-bar"></i> Agrupación *
                                    </label>
                                    <select id="reporte3-agrupacion" class="custom-select" required>
                                        <option value="diario">Diario</option>
                                        <option value="mensual">Mensual</option>
                                        <option value="anual">Anual</option>
                                    </select>
                                </div>
                            </div>
                            
                            <button class="generate-report-btn" id="generar-reporte3">
                                <i class="fas fa-chart-bar"></i> Generar Reporte
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="report-results-container" id="reporte3-resultados">
                    <div class="report-actions-top">
                        <button class="export-btn" id="volver-reporte3">
                            <i class="fas fa-arrow-left"></i> Volver al Formulario
                        </button>
                        <button class="export-btn" id="descargar-excel-reporte3">
                            <i class="fas fa-file-excel"></i> Descargar Excel
                        </button>
                        <button class="export-btn" id="descargar-pdf-reporte3">
                            <i class="fas fa-file-pdf"></i> Descargar PDF
                        </button>
                    </div>
                    
                    <div class="report-header-info">
                        <div>
                            <strong>Fecha de solicitud:</strong>
                            <span id="reporte3-fecha-solicitud"></span>
                        </div>
                        <div>
                            <strong>Solicitado por:</strong>
                            <span id="reporte3-solicitado-por">Carlos Rodríguez</span>
                        </div>
                    </div>
                    
                    <div class="report-table-card">
                        <div class="horizontal-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Estado</th>
                                        <th>Peaje</th>
                                        <th>Categoría</th>
                                        <th>Vehículos</th>
                                        <th>Recaudación (Bs.)</th>
                                    </tr>
                                </thead>
                                <tbody id="reporte3-tabla-body">
                                    <!-- Los datos se llenarán con JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reporte 4: Recaudación por Método de Pago y Categoría de Vehículo -->
        <div id="module-reporte4" class="module-container" style="display: none;">
            <div class="container">
                <div class="page-header">
                    <div class="page-title">
                        <h1><i class="fas fa-file-alt"></i> Reporte de Recaudación por Método de Pago y Categoría de Vehículo</h1>
                        <p class="subtitle">Reporte que refleja la recaudación de los peajes por cantidad de vehículos, método de pago y categoría</p>
                    </div>
                </div>
                
                <div class="report-form-container">
                    <div class="report-form-left">
                        <div style="margin-bottom: 18px;">
                            <div class="report-form-grid">
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-calendar-day"></i> Fecha de inicio *
                                    </label>
                                    <input type="date" id="reporte4-fecha-inicio" class="custom-select" required>
                                </div>
                                
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-calendar-day"></i> Fecha de fin *
                                    </label>
                                    <input type="date" id="reporte4-fecha-fin" class="custom-select" required>
                                </div>
                                
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-clock"></i> Hora de inicio
                                    </label>
                                    <input type="time" id="reporte4-hora-inicio" class="custom-select">
                                </div>
                                
                                <div class="filter-group">
                                    <label>
                                        <i class="fas fa-clock"></i> Hora de fin
                                    </label>
                                    <input type="time" id="reporte4-hora-fin" class="custom-select">
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-map-marker-alt"></i> Estado
                                    </label>
                                    <select id="reporte4-estado" class="custom-select" multiple>
                                        <option value="all" selected>Todos</option>
                                        <option value="carabobo">Carabobo</option>
                                        <option value="zulia">Zulia</option>
                                        <option value="miranda">Miranda</option>
                                        <option value="aragua">Aragua</option>
                                        <option value="lara">Lara</option>
                                        <option value="bolivar">Bolívar</option>
                                        <option value="tachira">Táchira</option>
                                        <option value="merida">Mérida</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-road"></i> Peaje
                                    </label>
                                    <select id="reporte4-peaje" class="custom-select" multiple>
                                        <option value="all" selected>Todos</option>
                                        <option value="valencia">Peaje Valencia</option>
                                        <option value="maracaibo">Peaje Maracaibo</option>
                                        <option value="caracas">Peaje Caracas</option>
                                        <option value="maracay">Peaje Maracay</option>
                                        <option value="barquisimeto">Peaje Barquisimeto</option>
                                        <option value="ciudadbolivar">Peaje Ciudad Bolívar</option>
                                        <option value="sanantonio">Peaje San Antonio</option>
                                        <option value="merida">Peaje Mérida</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-credit-card"></i> Método de Pago
                                    </label>
                                    <select id="reporte4-metodo-pago" class="custom-select" multiple>
                                        <option value="all" selected>Todos</option>
                                        <option value="efectivo">Efectivo</option>
                                        <option value="pago-movil">Pago Móvil</option>
                                        <option value="tarjeta-debito">Tarjeta de Débito</option>
                                        <option value="tarjeta-credito">Tarjeta de Crédito</option>
                                        <option value="tag">Tag</option>
                                        <option value="transferencia">Transferencia</option>
                                        <option value="billetera-digital">Billetera Digital</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-car"></i> Categoría de Vehículo
                                    </label>
                                    <select id="reporte4-categoria" class="custom-select" multiple>
                                        <option value="all" selected>Todos</option>
                                        <option value="livianos">Livianos</option>
                                        <option value="pesados">Pesados</option>
                                        <option value="motocicletas">Motocicletas</option>
                                        <option value="especiales">Especiales</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group report-form-full">
                                    <label>
                                        <i class="fas fa-chart-bar"></i> Agrupación *
                                    </label>
                                    <select id="reporte4-agrupacion" class="custom-select" required>
                                        <option value="diario">Diario</option>
                                        <option value="mensual">Mensual</option>
                                        <option value="anual">Anual</option>
                                    </select>
                                </div>
                            </div>
                            
                            <button class="generate-report-btn" id="generar-reporte4">
                                <i class="fas fa-chart-bar"></i> Generar Reporte
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="report-results-container" id="reporte4-resultados">
                    <div class="report-actions-top">
                        <button class="export-btn" id="volver-reporte4">
                            <i class="fas fa-arrow-left"></i> Volver al Formulario
                        </button>
                        <button class="export-btn" id="descargar-excel-reporte4">
                            <i class="fas fa-file-excel"></i> Descargar Excel
                        </button>
                        <button class="export-btn" id="descargar-pdf-reporte4">
                            <i class="fas fa-file-pdf"></i> Descargar PDF
                        </button>
                    </div>
                    
                    <div class="report-header-info">
                        <div>
                            <strong>Fecha de solicitud:</strong>
                            <span id="reporte4-fecha-solicitud"></span>
                        </div>
                        <div>
                            <strong>Solicitado por:</strong>
                            <span id="reporte4-solicitado-por">Carlos Rodríguez</span>
                        </div>
                    </div>
                    
                    <div class="report-table-card">
                        <div class="horizontal-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Estado</th>
                                        <th>Peaje</th>
                                        <th>Método de Pago</th>
                                        <th>Categoría</th>
                                        <th>Vehículos</th>
                                        <th>Recaudación (Bs.)</th>
                                    </tr>
                                </thead>
                                <tbody id="reporte4-tabla-body">
                                    <!-- Los datos se llenarán con JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Perfil del Usuario MODIFICADO -->
    <div id="profile-modal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 2003; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 12px; width: 90%; max-width: 650px; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);">
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 22px; border-bottom: 1px solid #eaeaea;">
                <h2 style="margin: 0; color: #2a5298; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-user-circle"></i> Perfil del Usuario
                </h2>
                <button id="close-profile-modal-btn" style="background: none; border: none; font-size: 22px; color: #666; cursor: pointer; transition: color 0.3s;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="padding: 22px;">
                <p class="subtitle" style="margin-bottom: 22px; color: #666; font-size: 1rem;">
                    Información personal y preferencias de la cuenta
                </p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-bottom: 22px;">
                    <div class="profile-form-group">
                        <label>
                            <i class="fas fa-user"></i> Nombre
                        </label>
                        <input type="text" id="profile-firstname" class="custom-select" value="Carlos" readonly>
                    </div>
                    
                    <div class="profile-form-group">
                        <label>
                            <i class="fas fa-user"></i> Apellido
                        </label>
                        <input type="text" id="profile-lastname" class="custom-select" value="Rodríguez" readonly>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-bottom: 22px;">
                    <div class="profile-form-group">
                        <label>
                            <i class="fas fa-id-card"></i> Cédula
                        </label>
                        <input type="text" id="profile-cedula" class="custom-select" value="V-12345678" readonly>
                    </div>
                    
                    <div class="profile-form-group">
                        <label>
                            <i class="fas fa-user-tag"></i> Usuario
                        </label>
                        <input type="text" id="profile-username" class="custom-select" value="crodriguez" readonly>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-bottom: 22px;">
                    <div class="profile-form-group">
                        <label>
                            <i class="fas fa-user-tag"></i> Rol
                        </label>
                        <input type="text" id="profile-role" class="custom-select" value="Administrador" readonly>
                    </div>
                    
                    <!-- Eliminado el campo de Fecha de Registro -->
                </div>
                
                <h3 style="margin: 25px 0 18px 0; color: #2a5298; border-bottom: 2px solid #eaeaea; padding-bottom: 8px;">
                    <i class="fas fa-lock"></i> Cambiar Contraseña
                </h3>
                
                <!-- Eliminado el campo de Contraseña Antigua -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-bottom: 22px;">
                    <div class="profile-form-group">
                        <label>
                            <i class="fas fa-lock"></i> Nueva Contraseña
                        </label>
                        <div class="password-input-container">
                            <input type="password" id="profile-new-password" class="custom-select" placeholder="Nueva contraseña">
                            <button type="button" class="password-toggle" id="toggle-new-password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="profile-form-group">
                        <label>
                            <i class="fas fa-lock"></i> Confirmar Nueva Contraseña
                        </label>
                        <div class="password-input-container">
                            <input type="password" id="profile-confirm-password" class="custom-select" placeholder="Confirmar nueva contraseña">
                            <button type="button" class="password-toggle" id="toggle-profile-confirm-password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; justify-content: flex-end; gap: 12px; padding: 18px 22px; border-top: 1px solid #eaeaea;">
                <button type="button" class="time-filter-btn" id="cancel-profile-btn">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="time-filter-btn active" id="save-profile-btn">
                    <i class="fas fa-save"></i> Guardar Cambios
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmación para Cerrar Sesión -->
    <div class="confirmation-modal" id="logout-confirm-modal">
        <div class="confirmation-content">
            <div class="confirmation-header">
                <i class="fas fa-sign-out-alt"></i>
                <h3>Confirmación</h3>
            </div>
            
            <div class="confirmation-body">
                <p>¿Estás seguro de querer cerrar sesión?</p>
            </div>
            
            <div class="confirmation-footer">
                <button class="confirmation-btn cancel" id="cancel-logout-btn">
                    Cancelar
                </button>
                <button class="confirmation-btn confirm" id="confirm-logout-btn">
                    Continuar
                </button>
            </div>
        </div>
    </div>

    <script>
        const tollSystemData = {
            day: {
                totalRevenue: 5847320,
                totalTransits: 142850,
                exoneratedTransits: 8571,
                tagTransits: 28570,
                
                dailyTrend: {
                    labels: ['6:00', '8:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00'],
                    revenue: [320500, 485200, 612300, 745800, 820100, 785400, 642100, 436920],
                    transits: [5200, 7850, 9850, 12050, 13200, 12500, 10200, 6850]
                },
                
                vehicleCategories: [
                    { name: "Livianos", revenue: 3800758, percentage: 65, color: "#4CAF50" },
                    { name: "Pesados", revenue: 1286406, percentage: 22, color: "#2196F3" },
                    { name: "Motocicletas", revenue: 467785, percentage: 8, color: "#FF9800" },
                    { name: "Especiales", revenue: 292366, percentage: 5, color: "#9C27B0" }
                ],
                
                paymentMethods: [
                    { name: "Efectivo", revenue: 2548320, percentage: 43.6, color: "#4CAF50" },
                    { name: "Pago Móvil", revenue: 1254320, percentage: 21.5, color: "#2196F3" },
                    { name: "Tarjeta de Débito", revenue: 985320, percentage: 16.9, color: "#FF9800" },
                    { name: "Tarjeta de Crédito", revenue: 654200, percentage: 11.2, color: "#9C27B0" },
                    { name: "Tag", revenue: 298160, percentage: 5.1, color: "#3F51B5" },
                    { name: "Transferencia", revenue: 65400, percentage: 1.1, color: "#00BCD4" },
                    { name: "Billetera Digital", revenue: 45600, percentage: 0.8, color: "#8BC34A" }
                ]
            },
            
            month: {
                totalRevenue: 158473200,
                totalTransits: 4285500,
                exoneratedTransits: 257130,
                tagTransits: 857100,
                
                dailyTrend: {
                    labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'],
                    revenue: [36589200, 38945100, 42015700, 40923200],
                    transits: [1050000, 1065000, 1090000, 1080500]
                },
                
                vehicleCategories: [
                    { name: "Livianos", revenue: 103007580, percentage: 65, color: "#4CAF50" },
                    { name: "Pesados", revenue: 34864060, percentage: 22, color: "#2196F3" },
                    { name: "Motocicletas", revenue: 12677850, percentage: 8, color: "#FF9800" },
                    { name: "Especiales", revenue: 7923660, percentage: 5, color: "#9C27B0" }
                ],
                
                paymentMethods: [
                    { name: "Efectivo", revenue: 69083200, percentage: 43.6, color: "#4CAF50" },
                    { name: "Pago Móvil", revenue: 34043200, percentage: 21.5, color: "#2196F3" },
                    { name: "Tarjeta de Débito", revenue: 26783200, percentage: 16.9, color: "#FF9800" },
                    { name: "Tarjeta de Crédito", revenue: 17742000, percentage: 11.2, color: "#9C27B0" },
                    { name: "Tag", revenue: 8081600, percentage: 5.1, color: "#3F51B5" },
                    { name: "Transferencia", revenue: 1743400, percentage: 1.1, color: "#00BCD4" },
                    { name: "Billetera Digital", revenue: 1267400, percentage: 0.8, color: "#8BC34A" }
                ]
            },
            
            year: {
                totalRevenue: 1895478400,
                totalTransits: 51426000,
                exoneratedTransits: 3085560,
                tagTransits: 10285200,
                
                dailyTrend: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                    revenue: [152000000, 148500000, 156800000, 142300000, 158200000, 158473200, 162100000, 155800000, 160500000, 157200000, 148900000, 151204200],
                    transits: [4250000, 4150000, 4380000, 3970000, 4420000, 4285500, 4530000, 4360000, 4490000, 4390000, 4160000, 4220000]
                },
                
                vehicleCategories: [
                    { name: "Livianos", revenue: 1232060580, percentage: 65, color: "#4CAF50" },
                    { name: "Pesados", revenue: 417004648, percentage: 22, color: "#2196F3" },
                    { name: "Motocicletas", revenue: 151638272, percentage: 8, color: "#FF9800" },
                    { name: "Especiales", revenue: 94773840, percentage: 5, color: "#9C27B0" }
                ],
                
                paymentMethods: [
                    { name: "Efectivo", revenue: 826832000, percentage: 43.6, color: "#4CAF50" },
                    { name: "Pago Móvil", revenue: 407432000, percentage: 21.5, color: "#2196F3" },
                    { name: "Tarjeta de Débito", revenue: 320432000, percentage: 16.9, color: "#FF9800" },
                    { name: "Tarjeta de Crédito", revenue: 212420000, percentage: 11.2, color: "#9C27B0" },
                    { name: "Tag", revenue: 96616000, percentage: 5.1, color: "#3F51B5" },
                    { name: "Transferencia", revenue: 20874000, percentage: 1.1, color: "#00BCD4" },
                    { name: "Billetera Digital", revenue: 15174000, percentage: 0.8, color: "#8BC34A" }
                ]
            },
            
            states: [
                { id: "carabobo", name: "Carabobo", revenue: 1254300, transits: 28500 },
                { id: "zulia", name: "Zulia", revenue: 980500, transits: 24500 },
                { id: "miranda", name: "Miranda", revenue: 875200, transits: 21500 },
                { id: "aragua", name: "Aragua", revenue: 745300, transits: 18500 },
                { id: "lara", name: "Lara", revenue: 652100, transits: 16500 },
                { id: "bolivar", name: "Bolívar", revenue: 523400, transits: 12500 },
                { id: "tachira", name: "Táchira", revenue: 485200, transits: 11800 },
                { id: "merida", name: "Mérida", revenue: 432320, transits: 10550 }
            ]
        };

        const operacionesData = {
            peajesPorEstado: {
                carabobo: [
                    { id: "valencia", name: "Peaje Valencia", revenue: 420500, transits: 9500 },
                    { id: "guacara", name: "Peaje Guacara", revenue: 380200, transits: 8200 },
                    { id: "sanjoaquin", name: "Peaje San Joaquín", revenue: 310800, transits: 7200 }
                ],
                zulia: [
                    { id: "maracaibo", name: "Peaje Maracaibo", revenue: 520300, transits: 11500 },
                    { id: "cabimas", name: "Peaje Cabimas", revenue: 280400, transits: 6500 },
                    { id: "ciudadojeda", name: "Peaje Ciudad Ojeda", revenue: 210200, transits: 5200 }
                ],
                miranda: [
                    { id: "caracas", name: "Peaje Caracas", revenue: 625400, transits: 13500 },
                    { id: "guarenas", name: "Peaje Guarenas", revenue: 320100, transits: 7500 },
                    { id: "guatire", name: "Peaje Guatire", revenue: 295300, transits: 6800 }
                ],
                aragua: [
                    { id: "maracay", name: "Peaje Maracay", revenue: 415600, transits: 9200 },
                    { id: "turmero", name: "Peaje Turmero", revenue: 285700, transits: 6400 },
                    { id: "cagua", name: "Peaje Cagua", revenue: 198400, transits: 4800 }
                ],
                lara: [
                    { id: "barquisimeto", name: "Peaje Barquisimeto", revenue: 385200, transits: 8500 },
                    { id: "cabudare", name: "Peaje Cabudare", revenue: 245300, transits: 5800 },
                    { id: "duaca", name: "Peaje Duaca", revenue: 167500, transits: 4200 }
                ],
                bolivar: [
                    { id: "ciudadbolivar", name: "Peaje Ciudad Bolívar", revenue: 295400, transits: 6800 },
                    { id: "upata", name: "Peaje Upata", revenue: 187600, transits: 4500 },
                    { id: "ciudadguayana", name: "Peaje Ciudad Guayana", revenue: 320800, transits: 7500 }
                ],
                tachira: [
                    { id: "sanantonio", name: "Peaje San Antonio", revenue: 275300, transits: 6200 },
                    { id: "san cristobal", name: "Peaje San Cristóbal", revenue: 310200, transits: 7200 },
                    { id: "rubio", name: "Peaje Rubio", revenue: 192400, transits: 4600 }
                ],
                merida: [
                    { id: "merida", name: "Peaje Mérida", revenue: 255600, transits: 5800 },
                    { id: "ejido", name: "Peaje Ejido", revenue: 187300, transits: 4400 },
                    { id: "tabay", name: "Peaje Tabay", revenue: 123500, transits: 3200 }
                ]
            },
            
            periodos: {
                day: {
                    channelPaymentData: {
                        channels: ['Canal 1', 'Canal 2', 'Canal 3', 'Canal 4', 'Canal 5'],
                        paymentMethods: ['Efectivo', 'Pago Móvil', 'Tarjeta Débito', 'Tarjeta Crédito', 'Tag'],
                        revenueData: [
                            [120500, 85000, 45200, 32800, 15000],
                            [95000, 72000, 38500, 29500, 22000],
                            [78000, 65000, 32000, 24500, 18000],
                            [105000, 82000, 48000, 36500, 25000],
                            [62500, 48000, 28500, 19800, 12000]
                        ]
                    },
                    channelTrafficData: {
                        channels: ['Canal 1', 'Canal 2', 'Canal 3', 'Canal 4', 'Canal 5'],
                        categories: ['Livianos', 'Pesados', 'Motocicletas', 'Especiales'],
                        trafficData: [
                            [850, 120, 180, 45],
                            [720, 95, 150, 35],
                            [680, 85, 140, 30],
                            [920, 135, 195, 50],
                            [550, 75, 110, 25]
                        ]
                    }
                },
                month: {
                    channelPaymentData: {
                        channels: ['Canal 1', 'Canal 2', 'Canal 3', 'Canal 4', 'Canal 5'],
                        paymentMethods: ['Efectivo', 'Pago Móvil', 'Tarjeta Débito', 'Tarjeta Crédito', 'Tag'],
                        revenueData: [
                            [3625000, 2550000, 1356000, 984000, 450000],
                            [2850000, 2160000, 1155000, 885000, 660000],
                            [2340000, 1950000, 960000, 735000, 540000],
                            [3150000, 2460000, 1440000, 1095000, 750000],
                            [1875000, 1440000, 855000, 594000, 360000]
                        ]
                    },
                    channelTrafficData: {
                        channels: ['Canal 1', 'Canal 2', 'Canal 3', 'Canal 4', 'Canal 5'],
                        categories: ['Livianos', 'Pesados', 'Motocicletas', 'Especiales'],
                        trafficData: [
                            [25500, 3600, 5400, 1350],
                            [21600, 2850, 4500, 1050],
                            [20400, 2550, 4200, 900],
                            [27600, 4050, 5850, 1500],
                            [16500, 2250, 3300, 750]
                        ]
                    }
                },
                year: {
                    channelPaymentData: {
                        channels: ['Canal 1', 'Canal 2', 'Canal 3', 'Canal 4', 'Canal 5'],
                        paymentMethods: ['Efectivo', 'Pago Móvil', 'Tarjeta Débito', 'Tarjeta Crédito', 'Tag'],
                        revenueData: [
                            [43500000, 30600000, 16272000, 11808000, 5400000],
                            [34200000, 25920000, 13860000, 10620000, 7920000],
                            [28080000, 23400000, 11520000, 8820000, 6480000],
                            [37800000, 29520000, 17280000, 13140000, 9000000],
                            [22500000, 17280000, 10260000, 7128000, 4320000]
                        ]
                    },
                    channelTrafficData: {
                        channels: ['Canal 1', 'Canal 2', 'Canal 3', 'Canal 4', 'Canal 5'],
                        categories: ['Livianos', 'Pesados', 'Motocicletas', 'Especiales'],
                        trafficData: [
                            [306000, 43200, 64800, 16200],
                            [259200, 34200, 54000, 12600],
                            [244800, 30600, 50400, 10800],
                            [331200, 48600, 70200, 18000],
                            [198000, 27000, 39600, 9000]
                        ]
                    }
                }
            }
        };

        const coordenadasEstados = {
            carabobo: { x: 45, y: 35, color: "#4CAF50", nombre: "Carabobo" },
            zulia: { x: 20, y: 25, color: "#2196F3", nombre: "Zulia" },
            miranda: { x: 60, y: 45, color: "#FF9800", nombre: "Miranda" },
            aragua: { x: 50, y: 30, color: "#9C27B0", nombre: "Aragua" },
            lara: { x: 35, y: 40, color: "#3F51B5", nombre: "Lara" },
            bolivar: { x: 70, y: 60, color: "#00BCD4", nombre: "Bolívar" },
            tachira: { x: 30, y: 60, color: "#8BC34A", nombre: "Táchira" },
            merida: { x: 40, y: 55, color: "#FF5722", nombre: "Mérida" }
        };

        const coordenadasPeajes = {
            "valencia": { estado: "carabobo", x: 48, y: 32 },
            "guacara": { estado: "carabobo", x: 46, y: 34 },
            "sanjoaquin": { estado: "carabobo", x: 44, y: 36 },
            "maracaibo": { estado: "zulia", x: 18, y: 22 },
            "cabimas": { estado: "zulia", x: 22, y: 24 },
            "ciudadojeda": { estado: "zulia", x: 20, y: 28 },
            "caracas": { estado: "miranda", x: 62, y: 44 },
            "guarenas": { estado: "miranda", x: 61, y: 46 },
            "guatire": { estado: "miranda", x: 63, y: 43 },
            "maracay": { estado: "aragua", x: 52, y: 28 },
            "turmero": { estado: "aragua", x: 51, y: 31 },
            "cagua": { estado: "aragua", x: 49, y: 33 },
            "barquisimeto": { estado: "lara", x: 37, y: 42 },
            "cabudare": { estado: "lara", x: 36, y: 41 },
            "duaca": { estado: "lara", x: 34, y: 39 },
            "ciudadbolivar": { estado: "bolivar", x: 72, y: 62 },
            "upata": { estado: "bolivar", x: 71, y: 61 },
            "ciudadguayana": { estado: "bolivar", x: 73, y: 63 },
            "sanantonio": { estado: "tachira", x: 28, y: 62 },
            "san cristobal": { estado: "tachira", x: 31, y: 61 },
            "rubio": { estado: "tachira", x: 29, y: 63 },
            "merida": { estado: "merida", x: 42, y: 57 },
            "ejido": { estado: "merida", x: 41, y: 56 },
            "tabay": { estado: "merida", x: 39, y: 54 }
        };

        const ejecutivoData = {
            monthlyTrend: {
                labels: ['Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic', 'Ene'],
                revenue: [142300000, 155800000, 160500000, 157200000, 148900000, 158473200, 162100000],
                transits: [3970000, 4360000, 4490000, 4390000, 4160000, 4285500, 4530000]
            },
            
            topPeajes: [
                { name: "Peaje Caracas", state: "Miranda", revenue: 625400, transits: 13500 },
                { name: "Peaje Maracaibo", state: "Zulia", revenue: 520300, transits: 11500 },
                { name: "Peaje Valencia", state: "Carabobo", revenue: 420500, transits: 9500 }
            ],
            
            previousMonthComparison: {
                revenue: { current: 158473200, previous: 146500000, change: 8.2 },
                transits: { current: 4285500, previous: 4140000, change: 3.5 },
                exonerated: { current: 257130, previous: 261800, change: -1.8 },
                tag: { current: 857100, previous: 762000, change: 12.5 }
            }
        };

        // Datos de ejemplo para usuarios (solo 11 usuarios)
        const usuariosData = [
            { id: 1, username: "crodriguez", firstname: "Carlos", lastname: "Rodríguez", cedula: "V-12345678", role: "administrador", status: "activo", createdAt: "2024-01-15", lastLogin: "2026-01-22 14:30" },
            { id: 2, username: "mgonzalez", firstname: "María", lastname: "González", cedula: "V-23456789", role: "administrador", status: "activo", createdAt: "2024-02-10", lastLogin: "2026-01-22 10:15" },
            { id: 3, username: "aperez", firstname: "Andrés", lastname: "Pérez", cedula: "V-34567890", role: "visualizador", status: "activo", createdAt: "2024-03-05", lastLogin: "2026-01-21 16:45" },
            { id: 4, username: "lramirez", firstname: "Laura", lastname: "Ramírez", cedula: "V-45678901", role: "visualizador", status: "activo", createdAt: "2024-04-12", lastLogin: "2026-01-20 09:20" },
            { id: 5, username: "jmartinez", firstname: "Javier", lastname: "Martínez", cedula: "V-56789012", role: "administrador", status: "activo", createdAt: "2024-05-18", lastLogin: "2026-01-22 08:10" },
            { id: 6, username: "asanchez", firstname: "Ana", lastname: "Sánchez", cedula: "V-67890123", role: "visualizador", status: "activo", createdAt: "2024-06-22", lastLogin: "2026-01-19 14:50" },
            { id: 7, username: "pgarcia", firstname: "Pedro", lastname: "García", cedula: "V-78901234", role: "visualizador", status: "inactivo", createdAt: "2024-07-30", lastLogin: "2025-12-15 11:30" },
            { id: 8, username: "clopez", firstname: "Carmen", lastname: "López", cedula: "V-89012345", role: "administrador", status: "activo", createdAt: "2024-08-14", lastLogin: "2026-01-22 12:05" },
            { id: 9, username: "rhernandez", firstname: "Roberto", lastname: "Hernández", cedula: "V-90123456", role: "visualizador", status: "activo", createdAt: "2024-09-05", lastLogin: "2026-01-21 17:20" },
            { id: 10, username: "mdiaz", firstname: "Mónica", lastname: "Díaz", cedula: "V-11223344", role: "visualizador", status: "activo", createdAt: "2024-10-10", lastLogin: "2026-01-22 13:40" },
            { id: 11, username: "jtorres", firstname: "José", lastname: "Torres", cedula: "V-22334455", role: "administrador", status: "inactivo", createdAt: "2024-11-25", lastLogin: "2025-11-30 10:15" }
        ];

        let trendChart, statesChart, vehicleCategoriesChart, paymentMethodsChart, paymentChannelChart;
        let currentPeriod = "day";
        let operacionesPeriod = "day";
        let estrategicoPeriod = "day";
        let estrategicoRecaudacionChart = null;
        let estrategicoTransitoChart = null;
        let ejecutivoTrendChart = null;
        
        // Variables para paginación y filtros de usuarios
        let currentUsersPage = 1;
        let usersPerPage = 10;
        let filteredUsers = [...usuariosData];
        let currentFilters = {
            search: ''
        };
        
        function formatNumber(number, decimals = 0) {
            if (number === undefined || number === null) {
                return '0';
            }
            
            const num = typeof number === 'string' ? parseFloat(number) : number;
            
            if (isNaN(num)) {
                return '0';
            }
            
            const parts = num.toFixed(decimals).toString().split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            
            return parts.length > 1 ? parts.join(',') : parts[0];
        }
        
        function formatCurrency(amount) {
            return 'Bs. ' + formatNumber(amount, 2);
        }
        
        function formatFullNumber(amount) {
            return formatNumber(amount, 0);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            setupEventListeners();
            checkDarkModePreference();
            checkSidebarState();
            setupPasswordToggles();
            setupReportesEventListeners();
        });
        
        function setupPasswordToggles() {
            // Toggle para formulario de usuario
            const togglePassword = document.getElementById('toggle-password');
            const toggleConfirmPassword = document.getElementById('toggle-confirm-password');
            const passwordField = document.getElementById('form-password');
            const confirmPasswordField = document.getElementById('form-confirm-password');
            
            if (togglePassword && passwordField) {
                togglePassword.addEventListener('click', function() {
                    const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordField.setAttribute('type', type);
                    this.querySelector('i').classList.toggle('fa-eye');
                    this.querySelector('i').classList.toggle('fa-eye-slash');
                });
            }
            
            if (toggleConfirmPassword && confirmPasswordField) {
                toggleConfirmPassword.addEventListener('click', function() {
                    const type = confirmPasswordField.getAttribute('type') === 'password' ? 'text' : 'password';
                    confirmPasswordField.setAttribute('type', type);
                    this.querySelector('i').classList.toggle('fa-eye');
                    this.querySelector('i').classList.toggle('fa-eye-slash');
                });
            }
            
            // Toggle para perfil
            const toggleNewPassword = document.getElementById('toggle-new-password');
            const toggleProfileConfirmPassword = document.getElementById('toggle-profile-confirm-password');
            const newPasswordField = document.getElementById('profile-new-password');
            const profileConfirmPasswordField = document.getElementById('profile-confirm-password');
            
            if (toggleNewPassword && newPasswordField) {
                toggleNewPassword.addEventListener('click', function() {
                    const type = newPasswordField.getAttribute('type') === 'password' ? 'text' : 'password';
                    newPasswordField.setAttribute('type', type);
                    this.querySelector('i').classList.toggle('fa-eye');
                    this.querySelector('i').classList.toggle('fa-eye-slash');
                });
            }
            
            if (toggleProfileConfirmPassword && profileConfirmPasswordField) {
                toggleProfileConfirmPassword.addEventListener('click', function() {
                    const type = profileConfirmPasswordField.getAttribute('type') === 'password' ? 'text' : 'password';
                    profileConfirmPasswordField.setAttribute('type', type);
                    this.querySelector('i').classList.toggle('fa-eye');
                    this.querySelector('i').classList.toggle('fa-eye-slash');
                });
            }
        }
        
        function setupReportesEventListeners() {
            // Reporte 1: Recaudación General
            document.getElementById('generar-reporte1').addEventListener('click', function() {
                generarReporte1();
            });
            
            document.getElementById('volver-reporte1').addEventListener('click', function() {
                document.getElementById('reporte1-resultados').style.display = 'none';
            });
            
            document.getElementById('descargar-excel-reporte1').addEventListener('click', function() {
                descargarExcel('reporte1');
            });
            
            document.getElementById('descargar-pdf-reporte1').addEventListener('click', function() {
                descargarPDF('reporte1');
            });
            
            // Reporte 2: Recaudación por Método de Pago
            document.getElementById('generar-reporte2').addEventListener('click', function() {
                generarReporte2();
            });
            
            document.getElementById('volver-reporte2').addEventListener('click', function() {
                document.getElementById('reporte2-resultados').style.display = 'none';
            });
            
            document.getElementById('descargar-excel-reporte2').addEventListener('click', function() {
                descargarExcel('reporte2');
            });
            
            document.getElementById('descargar-pdf-reporte2').addEventListener('click', function() {
                descargarPDF('reporte2');
            });
            
            // Reporte 3: Recaudación por Categoría de Vehículos
            document.getElementById('generar-reporte3').addEventListener('click', function() {
                generarReporte3();
            });
            
            document.getElementById('volver-reporte3').addEventListener('click', function() {
                document.getElementById('reporte3-resultados').style.display = 'none';
            });
            
            document.getElementById('descargar-excel-reporte3').addEventListener('click', function() {
                descargarExcel('reporte3');
            });
            
            document.getElementById('descargar-pdf-reporte3').addEventListener('click', function() {
                descargarPDF('reporte3');
            });
            
            // Reporte 4: Recaudación por Método de Pago y Categoría de Vehículo
            document.getElementById('generar-reporte4').addEventListener('click', function() {
                generarReporte4();
            });
            
            document.getElementById('volver-reporte4').addEventListener('click', function() {
                document.getElementById('reporte4-resultados').style.display = 'none';
            });
            
            document.getElementById('descargar-excel-reporte4').addEventListener('click', function() {
                descargarExcel('reporte4');
            });
            
            document.getElementById('descargar-pdf-reporte4').addEventListener('click', function() {
                descargarPDF('reporte4');
            });
        }
        
        function generarReporte1() {
            const fechaInicio = document.getElementById('reporte1-fecha-inicio').value;
            const fechaFin = document.getElementById('reporte1-fecha-fin').value;
            
            if (!fechaInicio || !fechaFin) {
                alert('Por favor complete las fechas de inicio y fin');
                return;
            }
            
            // Ocultar formulario y mostrar resultados
            document.querySelector('#module-reporte1 .report-form-container').style.display = 'none';
            document.getElementById('reporte1-resultados').style.display = 'block';
            
            // Actualizar información del encabezado
            const now = new Date();
            document.getElementById('reporte1-fecha-solicitud').textContent = now.toLocaleDateString('es-VE') + ' ' + now.toLocaleTimeString('es-VE');
            
            // Ejemplo de datos para la tabla
            const tablaBody = document.getElementById('reporte1-tabla-body');
            tablaBody.innerHTML = '';
            
            const datosEjemplo = [
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', vehiculos: 462, recaudacion: 1254300 },
                { fecha: '2026-01-22', estado: 'Zulia', peaje: 'Peaje Maracaibo', vehiculos: 403, recaudacion: 980500 },
                { fecha: '2026-01-22', estado: 'Carabobo', peaje: 'Peaje Valencia', vehiculos: 355, recaudacion: 875200 },
                { fecha: '2026-01-21', estado: 'Miranda', peaje: 'Peaje Caracas', vehiculos: 443, recaudacion: 1201500 },
                { fecha: '2026-01-21', estado: 'Zulia', peaje: 'Peaje Maracaibo', vehiculos: 384, recaudacion: 935200 },
                { fecha: '2026-01-21', estado: 'Carabobo', peaje: 'Peaje Valencia', vehiculos: 337, recaudacion: 820100 }
            ];
            
            // Agrupar por fecha para subtotales
            const subtotalesPorFecha = {};
            let totalVehiculos = 0;
            let totalRecaudacion = 0;
            
            // Primero, mostrar datos del 22
            datosEjemplo.filter(dato => dato.fecha === '2026-01-22').forEach(dato => {
                if (!subtotalesPorFecha[dato.fecha]) {
                    subtotalesPorFecha[dato.fecha] = {
                        vehiculos: 0,
                        recaudacion: 0
                    };
                }
                subtotalesPorFecha[dato.fecha].vehiculos += dato.vehiculos;
                subtotalesPorFecha[dato.fecha].recaudacion += dato.recaudacion;
                
                totalVehiculos += dato.vehiculos;
                totalRecaudacion += dato.recaudacion;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dato.fecha}</td>
                    <td>${dato.estado}</td>
                    <td>${dato.peaje}</td>
                    <td>${formatFullNumber(dato.vehiculos)}</td>
                    <td>${formatNumber(dato.recaudacion, 2)}</td>
                `;
                tablaBody.appendChild(row);
            });
            
            // Agregar subtotal del 22
            if (subtotalesPorFecha['2026-01-22']) {
                const subtotalRow = document.createElement('tr');
                subtotalRow.className = 'subtotal-row';
                subtotalRow.innerHTML = `
                    <td colspan="3" style="text-align: right; font-weight: 600;">Subtotal:</td>
                    <td style="font-weight: 600;">${formatFullNumber(subtotalesPorFecha['2026-01-22'].vehiculos)}</td>
                    <td style="font-weight: 600;">${formatNumber(subtotalesPorFecha['2026-01-22'].recaudacion, 2)}</td>
                `;
                tablaBody.appendChild(subtotalRow);
            }
            
            // Luego, mostrar datos del 21
            datosEjemplo.filter(dato => dato.fecha === '2026-01-21').forEach(dato => {
                if (!subtotalesPorFecha[dato.fecha]) {
                    subtotalesPorFecha[dato.fecha] = {
                        vehiculos: 0,
                        recaudacion: 0
                    };
                }
                subtotalesPorFecha[dato.fecha].vehiculos += dato.vehiculos;
                subtotalesPorFecha[dato.fecha].recaudacion += dato.recaudacion;
                
                totalVehiculos += dato.vehiculos;
                totalRecaudacion += dato.recaudacion;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dato.fecha}</td>
                    <td>${dato.estado}</td>
                    <td>${dato.peaje}</td>
                    <td>${formatFullNumber(dato.vehiculos)}</td>
                    <td>${formatNumber(dato.recaudacion, 2)}</td>
                `;
                tablaBody.appendChild(row);
            });
            
            // Agregar subtotal del 21
            if (subtotalesPorFecha['2026-01-21']) {
                const subtotalRow = document.createElement('tr');
                subtotalRow.className = 'subtotal-row';
                subtotalRow.innerHTML = `
                    <td colspan="3" style="text-align: right; font-weight: 600;">Subtotal:</td>
                    <td style="font-weight: 600;">${formatFullNumber(subtotalesPorFecha['2026-01-21'].vehiculos)}</td>
                    <td style="font-weight: 600;">${formatNumber(subtotalesPorFecha['2026-01-21'].recaudacion, 2)}</td>
                `;
                tablaBody.appendChild(subtotalRow);
            }
            
            // Agregar total general
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td colspan="3" style="text-align: right; font-weight: 600;">TOTAL:</td>
                <td style="font-weight: 600;">${formatFullNumber(totalVehiculos)}</td>
                <td style="font-weight: 600;">${formatNumber(totalRecaudacion, 2)}</td>
            `;
            tablaBody.appendChild(totalRow);
            
            // Hacer scroll a los resultados
            document.getElementById('reporte1-resultados').scrollIntoView({ behavior: 'smooth' });
        }
        
        function generarReporte2() {
            const fechaInicio = document.getElementById('reporte2-fecha-inicio').value;
            const fechaFin = document.getElementById('reporte2-fecha-fin').value;
            
            if (!fechaInicio || !fechaFin) {
                alert('Por favor complete las fechas de inicio y fin');
                return;
            }
            
            // Ocultar formulario y mostrar resultados
            document.querySelector('#module-reporte2 .report-form-container').style.display = 'none';
            document.getElementById('reporte2-resultados').style.display = 'block';
            
            // Actualizar información del encabezado
            const now = new Date();
            document.getElementById('reporte2-fecha-solicitud').textContent = now.toLocaleDateString('es-VE') + ' ' + now.toLocaleTimeString('es-VE');
            
            // Ejemplo de datos para la tabla
            const tablaBody = document.getElementById('reporte2-tabla-body');
            tablaBody.innerHTML = '';
            
            const datosEjemplo = [
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', metodo: 'Efectivo', vehiculos: 169, recaudacion: 450300 },
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', metodo: 'Pago Móvil', vehiculos: 140, recaudacion: 380200 },
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', metodo: 'Tag', vehiculos: 113, recaudacion: 305000 },
                { fecha: '2026-01-22', estado: 'Zulia', peaje: 'Peaje Maracaibo', metodo: 'Efectivo', vehiculos: 140, recaudacion: 380200 },
                { fecha: '2026-01-22', estado: 'Zulia', peaje: 'Peaje Maracaibo', metodo: 'Pago Móvil', vehiculos: 123, recaudacion: 330100 },
                { fecha: '2026-01-22', estado: 'Zulia', peaje: 'Peaje Maracaibo', metodo: 'Tag', vehiculos: 99, recaudacion: 270200 }
            ];
            
            // Agrupar por fecha para subtotales
            const subtotalesPorFecha = {};
            let totalVehiculos = 0;
            let totalRecaudacion = 0;
            
            datosEjemplo.forEach(dato => {
                if (!subtotalesPorFecha[dato.fecha]) {
                    subtotalesPorFecha[dato.fecha] = {
                        vehiculos: 0,
                        recaudacion: 0
                    };
                }
                subtotalesPorFecha[dato.fecha].vehiculos += dato.vehiculos;
                subtotalesPorFecha[dato.fecha].recaudacion += dato.recaudacion;
                
                totalVehiculos += dato.vehiculos;
                totalRecaudacion += dato.recaudacion;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dato.fecha}</td>
                    <td>${dato.estado}</td>
                    <td>${dato.peaje}</td>
                    <td>${dato.metodo}</td>
                    <td>${formatFullNumber(dato.vehiculos)}</td>
                    <td>${formatNumber(dato.recaudacion, 2)}</td>
                `;
                tablaBody.appendChild(row);
            });
            
            // Agregar subtotales por día
            Object.keys(subtotalesPorFecha).forEach(fecha => {
                const subtotalRow = document.createElement('tr');
                subtotalRow.className = 'subtotal-row';
                subtotalRow.innerHTML = `
                    <td colspan="4" style="text-align: right; font-weight: 600;">Subtotal:</td>
                    <td style="font-weight: 600;">${formatFullNumber(subtotalesPorFecha[fecha].vehiculos)}</td>
                    <td style="font-weight: 600;">${formatNumber(subtotalesPorFecha[fecha].recaudacion, 2)}</td>
                `;
                tablaBody.appendChild(subtotalRow);
            });
            
            // Agregar total general
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td colspan="4" style="text-align: right; font-weight: 600;">TOTAL:</td>
                <td style="font-weight: 600;">${formatFullNumber(totalVehiculos)}</td>
                <td style="font-weight: 600;">${formatNumber(totalRecaudacion, 2)}</td>
            `;
            tablaBody.appendChild(totalRow);
            
            // Hacer scroll a los resultados
            document.getElementById('reporte2-resultados').scrollIntoView({ behavior: 'smooth' });
        }
        
        function generarReporte3() {
            const fechaInicio = document.getElementById('reporte3-fecha-inicio').value;
            const fechaFin = document.getElementById('reporte3-fecha-fin').value;
            
            if (!fechaInicio || !fechaFin) {
                alert('Por favor complete las fechas de inicio y fin');
                return;
            }
            
            // Ocultar formulario y mostrar resultados
            document.querySelector('#module-reporte3 .report-form-container').style.display = 'none';
            document.getElementById('reporte3-resultados').style.display = 'block';
            
            // Actualizar información del encabezado
            const now = new Date();
            document.getElementById('reporte3-fecha-solicitud').textContent = now.toLocaleDateString('es-VE') + ' ' + now.toLocaleTimeString('es-VE');
            
            // Ejemplo de datos para la tabla
            const tablaBody = document.getElementById('reporte3-tabla-body');
            tablaBody.innerHTML = '';
            
            const datosEjemplo = [
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', categoria: 'Livianos', vehiculos: 320, recaudacion: 850300 },
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', categoria: 'Pesados', vehiculos: 85, recaudacion: 285000 },
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', categoria: 'Motocicletas', vehiculos: 45, recaudacion: 85000 },
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', categoria: 'Especiales', vehiculos: 12, recaudacion: 34000 },
                { fecha: '2026-01-22', estado: 'Zulia', peaje: 'Peaje Maracaibo', categoria: 'Livianos', vehiculos: 280, recaudacion: 720500 },
                { fecha: '2026-01-22', estado: 'Zulia', peaje: 'Peaje Maracaibo', categoria: 'Pesados', vehiculos: 75, recaudacion: 195000 },
                { fecha: '2026-01-22', estado: 'Zulia', peaje: 'Peaje Maracaibo', categoria: 'Motocicletas', vehiculos: 38, recaudacion: 70000 },
                { fecha: '2026-01-22', estado: 'Zulia', peaje: 'Peaje Maracaibo', categoria: 'Especiales', vehiculos: 10, recaudacion: 25000 }
            ];
            
            // Agrupar por fecha para subtotales
            const subtotalesPorFecha = {};
            let totalVehiculos = 0;
            let totalRecaudacion = 0;
            
            datosEjemplo.forEach(dato => {
                if (!subtotalesPorFecha[dato.fecha]) {
                    subtotalesPorFecha[dato.fecha] = {
                        vehiculos: 0,
                        recaudacion: 0
                    };
                }
                subtotalesPorFecha[dato.fecha].vehiculos += dato.vehiculos;
                subtotalesPorFecha[dato.fecha].recaudacion += dato.recaudacion;
                
                totalVehiculos += dato.vehiculos;
                totalRecaudacion += dato.recaudacion;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dato.fecha}</td>
                    <td>${dato.estado}</td>
                    <td>${dato.peaje}</td>
                    <td>${dato.categoria}</td>
                    <td>${formatFullNumber(dato.vehiculos)}</td>
                    <td>${formatNumber(dato.recaudacion, 2)}</td>
                `;
                tablaBody.appendChild(row);
            });
            
            // Agregar subtotales por día
            Object.keys(subtotalesPorFecha).forEach(fecha => {
                const subtotalRow = document.createElement('tr');
                subtotalRow.className = 'subtotal-row';
                subtotalRow.innerHTML = `
                    <td colspan="4" style="text-align: right; font-weight: 600;">Subtotal:</td>
                    <td style="font-weight: 600;">${formatFullNumber(subtotalesPorFecha[fecha].vehiculos)}</td>
                    <td style="font-weight: 600;">${formatNumber(subtotalesPorFecha[fecha].recaudacion, 2)}</td>
                `;
                tablaBody.appendChild(subtotalRow);
            });
            
            // Agregar total general
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td colspan="4" style="text-align: right; font-weight: 600;">TOTAL:</td>
                <td style="font-weight: 600;">${formatFullNumber(totalVehiculos)}</td>
                <td style="font-weight: 600;">${formatNumber(totalRecaudacion, 2)}</td>
            `;
            tablaBody.appendChild(totalRow);
            
            // Hacer scroll a los resultados
            document.getElementById('reporte3-resultados').scrollIntoView({ behavior: 'smooth' });
        }
        
        function generarReporte4() {
            const fechaInicio = document.getElementById('reporte4-fecha-inicio').value;
            const fechaFin = document.getElementById('reporte4-fecha-fin').value;
            
            if (!fechaInicio || !fechaFin) {
                alert('Por favor complete las fechas de inicio y fin');
                return;
            }
            
            // Ocultar formulario y mostrar resultados
            document.querySelector('#module-reporte4 .report-form-container').style.display = 'none';
            document.getElementById('reporte4-resultados').style.display = 'block';
            
            // Actualizar información del encabezado
            const now = new Date();
            document.getElementById('reporte4-fecha-solicitud').textContent = now.toLocaleDateString('es-VE') + ' ' + now.toLocaleTimeString('es-VE');
            
            // Ejemplo de datos para la tabla
            const tablaBody = document.getElementById('reporte4-tabla-body');
            tablaBody.innerHTML = '';
            
            const datosEjemplo = [
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', metodo: 'Efectivo', categoria: 'Livianos', vehiculos: 120, recaudacion: 320500 },
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', metodo: 'Efectivo', categoria: 'Pesados', vehiculos: 30, recaudacion: 105000 },
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', metodo: 'Pago Móvil', categoria: 'Livianos', vehiculos: 100, recaudacion: 270000 },
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', metodo: 'Pago Móvil', categoria: 'Pesados', vehiculos: 25, recaudacion: 87500 },
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', metodo: 'Tag', categoria: 'Livianos', vehiculos: 80, recaudacion: 216000 },
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', metodo: 'Tag', categoria: 'Pesados', vehiculos: 20, recaudacion: 70000 },
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', metodo: 'Efectivo', categoria: 'Motocicletas', vehiculos: 15, recaudacion: 30000 },
                { fecha: '2026-01-22', estado: 'Miranda', peaje: 'Peaje Caracas', metodo: 'Pago Móvil', categoria: 'Motocicletas', vehiculos: 12, recaudacion: 24000 }
            ];
            
            // Agrupar por fecha para subtotales
            const subtotalesPorFecha = {};
            let totalVehiculos = 0;
            let totalRecaudacion = 0;
            
            datosEjemplo.forEach(dato => {
                if (!subtotalesPorFecha[dato.fecha]) {
                    subtotalesPorFecha[dato.fecha] = {
                        vehiculos: 0,
                        recaudacion: 0
                    };
                }
                subtotalesPorFecha[dato.fecha].vehiculos += dato.vehiculos;
                subtotalesPorFecha[dato.fecha].recaudacion += dato.recaudacion;
                
                totalVehiculos += dato.vehiculos;
                totalRecaudacion += dato.recaudacion;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dato.fecha}</td>
                    <td>${dato.estado}</td>
                    <td>${dato.peaje}</td>
                    <td>${dato.metodo}</td>
                    <td>${dato.categoria}</td>
                    <td>${formatFullNumber(dato.vehiculos)}</td>
                    <td>${formatNumber(dato.recaudacion, 2)}</td>
                `;
                tablaBody.appendChild(row);
            });
            
            // Agregar subtotales por día
            Object.keys(subtotalesPorFecha).forEach(fecha => {
                const subtotalRow = document.createElement('tr');
                subtotalRow.className = 'subtotal-row';
                subtotalRow.innerHTML = `
                    <td colspan="5" style="text-align: right; font-weight: 600;">Subtotal:</td>
                    <td style="font-weight: 600;">${formatFullNumber(subtotalesPorFecha[fecha].vehiculos)}</td>
                    <td style="font-weight: 600;">${formatNumber(subtotalesPorFecha[fecha].recaudacion, 2)}</td>
                `;
                tablaBody.appendChild(subtotalRow);
            });
            
            // Agregar total general
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td colspan="5" style="text-align: right; font-weight: 600;">TOTAL:</td>
                <td style="font-weight: 600;">${formatFullNumber(totalVehiculos)}</td>
                <td style="font-weight: 600;">${formatNumber(totalRecaudacion, 2)}</td>
            `;
            tablaBody.appendChild(totalRow);
            
            // Hacer scroll a los resultados
            document.getElementById('reporte4-resultados').scrollIntoView({ behavior: 'smooth' });
        }
        
        function descargarExcel(reporteId) {
            alert(`Descargando reporte ${reporteId} en formato Excel...`);
            // En una implementación real, aquí se generaría y descargaría el archivo Excel
        }
        
        function descargarPDF(reporteId) {
            alert(`Descargando reporte ${reporteId} en formato PDF...`);
            // En una implementación real, aquí se generaría y descargaría el archivo PDF
        }
        
        function initializeDashboard() {
            updateMainCards(currentPeriod);
            initTrendChart(currentPeriod);
            initStatesChart();
            initVehicleCategoriesChart(currentPeriod);
            initPaymentMethodsChart(currentPeriod);
        }
        
        function updateMainCards(period) {
            const data = tollSystemData[period];
            
            document.getElementById('total-revenue').textContent = formatCurrency(data.totalRevenue);
            document.getElementById('total-transits').textContent = formatFullNumber(data.totalTransits);
            document.getElementById('exonerated-transits').textContent = formatFullNumber(data.exoneratedTransits);
            document.getElementById('tag-transits').textContent = formatFullNumber(data.tagTransits);
            
            const exoneratedPercentage = ((data.exoneratedTransits / data.totalTransits) * 100).toFixed(1).replace('.', ',');
            const tagPercentage = ((data.tagTransits / data.totalTransits) * 100).toFixed(1).replace('.', ',');
            
            document.getElementById('exonerated-detail').textContent = `${exoneratedPercentage}% del total de tránsitos`;
            document.getElementById('tag-detail').textContent = `${tagPercentage}% del total de tránsitos`;
        }
        
        function initTrendChart(period) {
            const ctx = document.getElementById('trend-chart').getContext('2d');
            const data = tollSystemData[period];
            
            if (trendChart) {
                trendChart.destroy();
            }
            
            const isDarkMode = document.body.classList.contains('dark-mode');
            const lineColor = isDarkMode ? '#4d8aff' : '#2a5298';
            const transitColor = isDarkMode ? '#66bb6a' : '#4CAF50';
            
            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.dailyTrend.labels,
                    datasets: [
                        {
                            label: 'Recaudación',
                            data: data.dailyTrend.revenue,
                            backgroundColor: isDarkMode ? 'rgba(77, 138, 255, 0.1)' : 'rgba(42, 82, 152, 0.1)',
                            borderColor: lineColor,
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Tránsitos',
                            data: data.dailyTrend.transits,
                            backgroundColor: isDarkMode ? 'rgba(102, 187, 106, 0.1)' : 'rgba(76, 175, 80, 0.1)',
                            borderColor: transitColor,
                            borderWidth: 3,
                            fill: false,
                            tension: 0.3,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: isDarkMode ? '#e0e0e0' : '#333'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `Recaudación: ${formatCurrency(context.parsed.y)}`;
                                    } else {
                                        return `Tránsitos: ${formatFullNumber(context.parsed.y)}`;
                                    }
                                }
                            },
                            backgroundColor: isDarkMode ? '#2d2d2d' : '#ffffff',
                            titleColor: isDarkMode ? '#e0e0e0' : '#333',
                            bodyColor: isDarkMode ? '#e0e0e0' : '#333',
                            borderColor: isDarkMode ? '#444' : '#ddd'
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Recaudación (Bs.)',
                                color: isDarkMode ? '#e0e0e0' : '#333'
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                },
                                color: isDarkMode ? '#b0b0b0' : '#666'
                            },
                            grid: {
                                color: isDarkMode ? '#333' : '#e0e0e0'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Tránsitos',
                                color: isDarkMode ? '#e0e0e0' : '#333'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatFullNumber(value);
                                },
                                color: isDarkMode ? '#b0b0b0' : '#666'
                            }
                        },
                        x: {
                            ticks: {
                                color: isDarkMode ? '#b0b0b0' : '#666'
                            },
                            grid: {
                                color: isDarkMode ? '#333' : '#e0e0e0'
                            }
                        }
                    }
                }
            });
        }
        
        function initStatesChart() {
            const ctx = document.getElementById('states-chart').getContext('2d');
            
            const stateNames = tollSystemData.states.map(state => state.name);
            const stateRevenues = tollSystemData.states.map(state => state.revenue);
            
            if (statesChart) {
                statesChart.destroy();
            }
            
            const isDarkMode = document.body.classList.contains('dark-mode');
            const barColor = isDarkMode ? '#4d8aff' : '#2a5298';
            const borderColor = isDarkMode ? '#3a6bd6' : '#1e3c72';
            
            statesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: stateNames,
                    datasets: [{
                        label: 'Recaudación (Bs.)',
                        data: stateRevenues,
                        backgroundColor: barColor,
                        borderColor: borderColor,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const state = tollSystemData.states[context.dataIndex];
                                    const totalRevenue = tollSystemData[currentPeriod].totalRevenue;
                                    const percentage = ((state.revenue / totalRevenue) * 100).toFixed(1).replace('.', ',');
                                    return `Recaudación: ${formatCurrency(context.parsed.y)} (${percentage}%)`;
                                }
                            },
                            backgroundColor: isDarkMode ? '#2d2d2d' : '#ffffff',
                            titleColor: isDarkMode ? '#e0e0e0' : '#333',
                            bodyColor: isDarkMode ? '#e0e0e0' : '#333',
                            borderColor: isDarkMode ? '#444' : '#ddd'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                },
                                color: isDarkMode ? '#b0b0b0' : '#666'
                            },
                            grid: {
                                color: isDarkMode ? '#333' : '#e0e0e0'
                            }
                        },
                        x: {
                            ticks: {
                                color: isDarkMode ? '#b0b0b0' : '#666'
                            },
                            grid: {
                                color: isDarkMode ? '#333' : '#e0e0e0'
                            }
                        }
                    }
                }
            });
        }
        
        function initVehicleCategoriesChart(period) {
            const ctx = document.getElementById('vehicle-categories-chart').getContext('2d');
            const data = tollSystemData[period];
            
            if (vehicleCategoriesChart) {
                vehicleCategoriesChart.destroy();
            }
            
            const isDarkMode = document.body.classList.contains('dark-mode');
            
            vehicleCategoriesChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.vehicleCategories.map(category => category.name),
                    datasets: [{
                        data: data.vehicleCategories.map(category => category.percentage),
                        backgroundColor: data.vehicleCategories.map(category => category.color),
                        borderWidth: 2,
                        borderColor: isDarkMode ? '#333' : '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: isDarkMode ? '#e0e0e0' : '#333'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed.toFixed(1).replace('.', ',');
                                    const category = data.vehicleCategories[context.dataIndex];
                                    return `${label}: ${value}% (${formatCurrency(category.revenue)})`;
                                }
                            },
                            backgroundColor: isDarkMode ? '#2d2d2d' : '#ffffff',
                            titleColor: isDarkMode ? '#e0e0e0' : '#333',
                            bodyColor: isDarkMode ? '#e0e0e0' : '#333',
                            borderColor: isDarkMode ? '#444' : '#ddd'
                        }
                    }
                }
            });
        }
        
        function initPaymentMethodsChart(period) {
            const ctx = document.getElementById('payment-methods-chart').getContext('2d');
            const data = tollSystemData[period];
            
            if (paymentMethodsChart) {
                paymentMethodsChart.destroy();
            }
            
            const isDarkMode = document.body.classList.contains('dark-mode');
            
            paymentMethodsChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.paymentMethods.map(method => method.name),
                    datasets: [{
                        data: data.paymentMethods.map(method => method.percentage),
                        backgroundColor: data.paymentMethods.map(method => method.color),
                        borderWidth: 2,
                        borderColor: isDarkMode ? '#333' : '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: isDarkMode ? '#e0e0e0' : '#333'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed.toFixed(1).replace('.', ',');
                                    const method = data.paymentMethods[context.dataIndex];
                                    return `${label}: ${value}% (${formatCurrency(method.revenue)})`;
                                }
                            },
                            backgroundColor: isDarkMode ? '#2d2d2d' : '#ffffff',
                            titleColor: isDarkMode ? '#e0e0e0' : '#333',
                            bodyColor: isDarkMode ? '#e0e0e0' : '#333',
                            borderColor: isDarkMode ? '#444' : '#ddd'
                        }
                    }
                }
            });
        }
        
        function initOperacionesModule() {
            console.log("Inicializando módulo operaciones...");
            
            const estadoFilter = document.getElementById('estado-filter');
            const peajeFilter = document.getElementById('peaje-filter');
            
            cargarPeajes(estadoFilter.value);
            
            estadoFilter.addEventListener('change', function() {
                const estado = this.value;
                cargarPeajes(estado);
            });
            
            const timeFilterButtons = document.querySelectorAll('#module-operaciones .time-filter-btn');
            
            timeFilterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    timeFilterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    operacionesPeriod = this.getAttribute('data-period');
                    initPaymentChannelChart(operacionesPeriod);
                });
            });
            
            document.getElementById('export-operaciones-data').addEventListener('click', function() {
                const estado = document.getElementById('estado-filter').value;
                const peaje = document.getElementById('peaje-filter').value;
                const periodoText = operacionesPeriod === 'day' ? 'Día' : operacionesPeriod === 'month' ? 'Mes' : 'Año';
                
                const exportData = {
                    modulo: "Operaciones",
                    periodo: periodoText,
                    fecha: new Date().toLocaleDateString('es-VE'),
                    hora: new Date().toLocaleTimeString('es-VE'),
                    filtros: {
                        estado: estado,
                        peaje: peaje
                    },
                    datos: operacionesData.periodos[operacionesPeriod]
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const downloadLink = document.createElement('a');
                downloadLink.href = URL.createObjectURL(dataBlob);
                downloadLink.download = `datos_operaciones_${periodoText.toLowerCase()}_${new Date().toISOString().split('T')[0]}.json`;
                
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                alert(`Datos de operaciones del período ${periodoText} exportados correctamente.`);
            });
            
            initPaymentChannelChart(operacionesPeriod);
        }
        
        function cargarPeajes(estado) {
            const peajeFilter = document.getElementById('peaje-filter');
            const peajes = operacionesData.peajesPorEstado[estado];
            
            if (peajes && peajes.length > 0) {
                peajeFilter.innerHTML = '';
                
                peajes.forEach(peaje => {
                    peajeFilter.innerHTML += `<option value="${peaje.id}">${peaje.name}</option>`;
                });
                
                peajeFilter.disabled = false;
                peajeFilter.value = peajes[0].id;
            } else {
                peajeFilter.innerHTML = '<option value="">No hay peajes disponibles</option>';
                peajeFilter.disabled = true;
            }
        }

        function initPaymentChannelChart(period) {
            const ctx = document.getElementById('payment-channel-chart').getContext('2d');
            const data = operacionesData.periodos[period].channelPaymentData;
            
            if (paymentChannelChart) {
                paymentChannelChart.destroy();
            }
            
            const isDarkMode = document.body.classList.contains('dark-mode');
            
            const paymentMethodColors = [
                '#4CAF50',
                '#2196F3',
                '#FF9800',
                '#9C27B0',
                '#3F51B5'
            ];
            
            const datasets = data.paymentMethods.map((method, index) => {
                const methodData = data.revenueData.map(channelData => channelData[index]);
                
                return {
                    label: method,
                    data: methodData,
                    backgroundColor: paymentMethodColors[index],
                    borderColor: isDarkMode ? '#333' : '#fff',
                    borderWidth: 1
                };
            });
            
            paymentChannelChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.channels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: isDarkMode ? '#e0e0e0' : '#333'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatCurrency(context.parsed.y)}`;
                                }
                            },
                            backgroundColor: isDarkMode ? '#2d2d2d' : '#ffffff',
                            titleColor: isDarkMode ? '#e0e0e0' : '#333',
                            bodyColor: isDarkMode ? '#e0e0e0' : '#333',
                            borderColor: isDarkMode ? '#444' : '#ddd'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Recaudación (Bs.)',
                                color: isDarkMode ? '#e0e0e0' : '#333'
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                },
                                color: isDarkMode ? '#b0b0b0' : '#666'
                            },
                            stacked: true,
                            grid: {
                                color: isDarkMode ? '#333' : '#e0e0e0'
                            }
                        },
                        x: {
                            ticks: {
                                color: isDarkMode ? '#b0b0b0' : '#666'
                            },
                            stacked: true,
                            grid: {
                                color: isDarkMode ? '#333' : '#e0e0e0'
                            }
                        }
                    }
                }
            });
            
            updateChannelTrafficTable(period);
        }

        function updateChannelTrafficTable(period) {
            const trafficData = operacionesData.periodos[period].channelTrafficData;
            const paymentData = operacionesData.periodos[period].channelPaymentData;
            const tableHead = document.getElementById('channel-traffic-head');
            const tableBody = document.getElementById('channel-traffic-body');
            
            tableHead.innerHTML = '';
            tableBody.innerHTML = '';
            
            const channels = trafficData.channels;
            const categories = trafficData.categories;
            
            let headerHTML = '<tr>';
            headerHTML += '<th>Categoría / Canal</th>';
            
            channels.forEach(channel => {
                headerHTML += `<th>${channel}</th>`;
            });
            
            headerHTML += '<th>Total</th>';
            headerHTML += '</tr>';
            
            tableHead.innerHTML = headerHTML;
            
            categories.forEach((category, catIndex) => {
                const row = document.createElement('tr');
                
                if (catIndex % 2 === 0) {
                    row.style.backgroundColor = document.body.classList.contains('dark-mode') ? '#2d2d2d' : '#f9f9f9';
                }
                
                let rowHTML = `<td style="font-weight: 600;">${category}</td>`;
                
                let categoriaTotal = 0;
                
                channels.forEach((channel, chIndex) => {
                    const value = trafficData.trafficData[chIndex][catIndex];
                    categoriaTotal += value;
                    rowHTML += `<td>${formatFullNumber(value)}</td>`;
                });
                
                rowHTML += `<td style="font-weight: 600;">${formatFullNumber(categoriaTotal)}</td>`;
                
                row.innerHTML = rowHTML;
                tableBody.appendChild(row);
            });
            
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            
            let totalRowHTML = '<td style="font-weight: 600;">Total Vehículos</td>';
            
            let totalGeneral = 0;
            
            channels.forEach((channel, chIndex) => {
                let canalTotal = 0;
                categories.forEach((category, catIndex) => {
                    canalTotal += trafficData.trafficData[chIndex][catIndex];
                });
                totalGeneral += canalTotal;
                totalRowHTML += `<td style="font-weight: 600;">${formatFullNumber(canalTotal)}</td>`;
            });
            
            totalRowHTML += `<td style="font-weight: 600;">${formatFullNumber(totalGeneral)}</td>`;
            
            totalRow.innerHTML = totalRowHTML;
            tableBody.appendChild(totalRow);
            
            const revenueRow = document.createElement('tr');
            revenueRow.className = 'revenue-row';
            
            let revenueRowHTML = '<td style="font-weight: 600;">Recaudación</td>';
            
            let revenueTotal = 0;
            
            channels.forEach((channel, chIndex) => {
                let canalRevenue = 0;
                paymentData.revenueData[chIndex].forEach(revenue => {
                    canalRevenue += revenue;
                });
                revenueTotal += canalRevenue;
                revenueRowHTML += `<td style="font-weight: 600;">${formatCurrency(canalRevenue)}</td>`;
            });
            
            revenueRowHTML += `<td style="font-weight: 600;">${formatCurrency(revenueTotal)}</td>`;
            
            revenueRow.innerHTML = revenueRowHTML;
            tableBody.appendChild(revenueRow);
        }

        function initEstrategicoModule() {
            console.log("Inicializando módulo estratégico...");
            
            const estadoFilter = document.getElementById('estrategico-estado-filter');
            
            const timeFilterButtons = document.querySelectorAll('#module-estrategico .time-filter-btn');
            
            timeFilterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    timeFilterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    estrategicoPeriod = this.getAttribute('data-period');
                    updateEstrategicoData();
                });
            });
            
            estadoFilter.addEventListener('change', function() {
                updateEstrategicoData();
            });
            
            document.getElementById('export-estrategico-data').addEventListener('click', function() {
                exportEstrategicoData();
            });
            
            updateEstrategicoData();
        }

        function updateEstrategicoData() {
            const estadoFilter = document.getElementById('estrategico-estado-filter');
            const selectedOptions = Array.from(estadoFilter.selectedOptions).map(option => option.value);
            
            let estadosSeleccionados;
            if (selectedOptions.includes('all') || selectedOptions.length === 0) {
                estadosSeleccionados = tollSystemData.states.map(state => state.id);
            } else {
                estadosSeleccionados = selectedOptions;
            }
            
            const periodData = tollSystemData[estrategicoPeriod];
            const estadosData = tollSystemData.states.filter(state => estadosSeleccionados.includes(state.id));
            
            let totalRevenue = 0;
            let totalTransits = 0;
            
            estadosData.forEach(state => {
                totalRevenue += state.revenue;
                totalTransits += state.transits;
            });
            
            document.getElementById('estrategico-total-revenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('estrategico-total-transits').textContent = formatFullNumber(totalTransits);
            
            let topState = null;
            let maxRevenue = 0;
            
            estadosData.forEach(state => {
                if (state.revenue > maxRevenue) {
                    maxRevenue = state.revenue;
                    topState = state;
                }
            });
            
            if (topState) {
                document.getElementById('estrategico-top-state').textContent = topState.name;
                const percentage = ((topState.revenue / totalRevenue) * 100).toFixed(1).replace('.', ',');
                document.getElementById('estrategico-top-state-detail').textContent = `${percentage}% del total`;
            }
            
            let topToll = null;
            let topTollRevenue = 0;
            
            estadosSeleccionados.forEach(estadoId => {
                const peajes = operacionesData.peajesPorEstado[estadoId] || [];
                peajes.forEach(peaje => {
                    if (peaje.revenue > topTollRevenue) {
                        topTollRevenue = peaje.revenue;
                        topToll = peaje;
                    }
                });
            });
            
            if (topToll) {
                document.getElementById('estrategico-top-toll').textContent = topToll.name;
                const percentage = ((topToll.revenue / totalRevenue) * 100).toFixed(1).replace('.', ',');
                document.getElementById('estrategico-top-toll-detail').textContent = `${percentage}% del total`;
            }
            
            updateDistribucionTable(estadosData, totalRevenue, totalTransits);
            updateEstrategicoCharts(estadosSeleccionados);
            updateMapaPeajes(estadosSeleccionados);
        }

        function updateDistribucionTable(estadosData, totalRevenue, totalTransits) {
            const tableBody = document.getElementById('estrategico-distribucion-body');
            tableBody.innerHTML = '';
            
            const sortedEstados = estadosData.sort((a, b) => b.revenue - a.revenue);
            
            sortedEstados.forEach((state, index) => {
                const row = document.createElement('tr');
                
                if (index % 2 === 0) {
                    row.style.backgroundColor = document.body.classList.contains('dark-mode') ? '#2d2d2d' : '#f9f9f9';
                }
                
                const percentage = ((state.revenue / totalRevenue) * 100).toFixed(1).replace('.', ',');
                const peajes = operacionesData.peajesPorEstado[state.id] || [];
                const peajesCount = peajes.length;
                
                row.innerHTML = `
                    <td style="text-align: center;">${index + 1}</td>
                    <td style="font-weight: 600;">${state.name}</td>
                    <td>${formatCurrency(state.revenue)}</td>
                    <td>${formatFullNumber(state.transits)}</td>
                    <td>${percentage}%</td>
                    <td>${peajesCount}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        function updateEstrategicoCharts(estadosSeleccionados) {
            let allPeajes = [];
            
            estadosSeleccionados.forEach(estadoId => {
                const peajes = operacionesData.peajesPorEstado[estadoId] || [];
                allPeajes = allPeajes.concat(peajes);
            });
            
            allPeajes.sort((a, b) => b.revenue - a.revenue);
            const topPeajes = allPeajes.slice(0, 10);
            
            const peajesNames = topPeajes.map(peaje => peaje.name);
            const peajesRevenue = topPeajes.map(peaje => peaje.revenue);
            const peajesTransits = topPeajes.map(peaje => peaje.transits);
            
            const ctxRecaudacion = document.getElementById('estrategico-recaudacion-peaje-chart').getContext('2d');
            const ctxTransito = document.getElementById('estrategico-transito-peaje-chart').getContext('2d');
            
            const isDarkMode = document.body.classList.contains('dark-mode');
            const barColor = isDarkMode ? '#4d8aff' : '#2a5298';
            const borderColor = isDarkMode ? '#3a6bd6' : '#1e3c72';
            
            if (estrategicoRecaudacionChart) {
                estrategicoRecaudacionChart.destroy();
            }
            if (estrategicoTransitoChart) {
                estrategicoTransitoChart.destroy();
            }
            
            estrategicoRecaudacionChart = new Chart(ctxRecaudacion, {
                type: 'bar',
                data: {
                    labels: peajesNames,
                    datasets: [{
                        label: 'Recaudación (Bs.)',
                        data: peajesRevenue,
                        backgroundColor: barColor,
                        borderColor: borderColor,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Recaudación: ${formatCurrency(context.parsed.y)}`;
                                }
                            },
                            backgroundColor: isDarkMode ? '#2d2d2d' : '#ffffff',
                            titleColor: isDarkMode ? '#e0e0e0' : '#333',
                            bodyColor: isDarkMode ? '#e0e0e0' : '#333',
                            borderColor: isDarkMode ? '#444' : '#ddd'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                },
                                color: isDarkMode ? '#b0b0b0' : '#666'
                            },
                            grid: {
                                color: isDarkMode ? '#333' : '#e0e0e0'
                            }
                        },
                        x: {
                            ticks: {
                                color: isDarkMode ? '#b0b0b0' : '#666',
                                maxRotation: 45,
                                minRotation: 45
                            },
                            grid: {
                                color: isDarkMode ? '#333' : '#e0e0e0'
                            }
                        }
                    }
                }
            });
            
            estrategicoTransitoChart = new Chart(ctxTransito, {
                type: 'bar',
                data: {
                    labels: peajesNames,
                    datasets: [{
                        label: 'Tránsito',
                        data: peajesTransits,
                        backgroundColor: isDarkMode ? '#66bb6a' : '#4CAF50',
                        borderColor: isDarkMode ? '#4c8c4f' : '#2E7D32',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Tránsito: ${formatFullNumber(context.parsed.y)}`;
                                }
                            },
                            backgroundColor: isDarkMode ? '#2d2d2d' : '#ffffff',
                            titleColor: isDarkMode ? '#e0e0e0' : '#333',
                            bodyColor: isDarkMode ? '#e0e0e0' : '#333',
                            borderColor: isDarkMode ? '#444' : '#ddd'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatFullNumber(value);
                                },
                                color: isDarkMode ? '#b0b0b0' : '#666'
                            },
                            grid: {
                                color: isDarkMode ? '#333' : '#e0e0e0'
                            }
                        },
                        x: {
                            ticks: {
                                color: isDarkMode ? '#b0b0b0' : '#666',
                                maxRotation: 45,
                                minRotation: 45
                            },
                            grid: {
                                color: isDarkMode ? '#333' : '#e0e0e0'
                            }
                        }
                    }
                }
            });
        }

        function updateMapaPeajes(estadosSeleccionados) {
            const mapaContainer = document.getElementById('mapa-nacional');
            
            const iconosAnteriores = mapaContainer.querySelectorAll('.mapa-peaje-icon, .mapa-peaje-tooltip');
            iconosAnteriores.forEach(icono => icono.remove());
            
            let allPeajes = [];
            let peajesCount = 0;
            
            estadosSeleccionados.forEach(estadoId => {
                const peajes = operacionesData.peajesPorEstado[estadoId] || [];
                allPeajes = allPeajes.concat(peajes);
                peajesCount += peajes.length;
            });
            
            document.getElementById('contador-peajes').textContent = peajesCount;
            document.getElementById('mapa-info').style.display = 'none';
            
            if (allPeajes.length === 0) {
                const mensaje = document.createElement('div');
                mensaje.style.position = 'absolute';
                mensaje.style.top = '50%';
                mensaje.style.left = '50%';
                mensaje.style.transform = 'translate(-50%, -50%)';
                mensaje.style.color = '#666';
                mensaje.style.fontSize = '16px';
                mensaje.style.textAlign = 'center';
                mensaje.innerHTML = '<i class="fas fa-road fa-2x" style="margin-bottom: 12px;"></i><br>No hay peajes en los estados seleccionados';
                mapaContainer.appendChild(mensaje);
                return;
            }
            
            const colorFijo = '#2a5298';
            
            allPeajes.forEach(peaje => {
                const coords = coordenadasPeajes[peaje.id];
                if (!coords) return;
                
                const posX = coords.x;
                const posY = coords.y;
                
                const icono = document.createElement('div');
                icono.className = 'mapa-peaje-icon';
                icono.id = `peaje-${peaje.id}`;
                icono.style.left = `${posX}%`;
                icono.style.top = `${posY}%`;
                icono.style.backgroundColor = colorFijo;
                icono.style.border = `2px solid ${colorFijo}`;
                icono.innerHTML = '<i class="fas fa-road"></i>';
                
                const tooltip = document.createElement('div');
                tooltip.className = 'mapa-peaje-tooltip';
                tooltip.id = `tooltip-${peaje.id}`;
                tooltip.style.left = `${posX}%`;
                tooltip.style.top = `${posY}%`;
                
                tooltip.innerHTML = `
                    <h4>${peaje.name}</h4>
                    <p><strong>Estado:</strong> ${coordenadasEstados[coords.estado].nombre}</p>
                    <p><strong>Recaudación:</strong> ${formatCurrency(peaje.revenue)}</p>
                    <p><strong>Tránsito:</strong> ${formatFullNumber(peaje.transits)} vehículos</p>
                    <p><em>Click para más detalles</em></p>
                `;
                
                icono.addEventListener('mouseenter', function() {
                    tooltip.classList.add('active');
                });
                
                icono.addEventListener('mouseleave', function() {
                    tooltip.classList.remove('active');
                });
                
                icono.addEventListener('click', function() {
                    mostrarDetallePeaje(peaje, coords.estado);
                });
                
                mapaContainer.appendChild(icono);
                mapaContainer.appendChild(tooltip);
            });
            
            estadosSeleccionados.forEach(estadoId => {
                const estado = coordenadasEstados[estadoId];
                if (!estado) return;
                
                const nombreEstado = document.createElement('div');
                nombreEstado.style.position = 'absolute';
                nombreEstado.style.left = `${estado.x}%`;
                nombreEstado.style.top = `${estado.y}%`;
                nombreEstado.style.transform = 'translate(-50%, 20px)';
                nombreEstado.style.color = estado.color;
                nombreEstado.style.fontWeight = '600';
                nombreEstado.style.fontSize = '12px';
                nombreEstado.style.textShadow = '1px 1px 2px rgba(255,255,255,0.8)';
                nombreEstado.style.pointerEvents = 'none';
                nombreEstado.textContent = estado.nombre;
                
                mapaContainer.appendChild(nombreEstado);
            });
        }

        function mostrarDetallePeaje(peaje, estadoId) {
            const mapaInfo = document.getElementById('mapa-info');
            const mapaInfoContent = document.getElementById('mapa-info-content');
            
            const estadoData = tollSystemData.states.find(s => s.id === estadoId);
            const estadoNombre = estadoData ? estadoData.name : 'Desconocido';
            
            const totalEstadoRevenue = estadoData ? estadoData.revenue : 0;
            const totalEstadoTransits = estadoData ? estadoData.transits : 0;
            
            const porcentajeRecaudacion = totalEstadoRevenue > 0 ? ((peaje.revenue / totalEstadoRevenue) * 100).toFixed(1).replace('.', ',') : '0';
            const porcentajeTransito = totalEstadoTransits > 0 ? ((peaje.transits / totalEstadoTransits) * 100).toFixed(1).replace('.', ',') : '0';
            
            mapaInfoContent.innerHTML = `
                <div>
                    <h4><i class="fas fa-road"></i> Información General</h4>
                    <div class="valor">${peaje.name}</div>
                    <div class="detalle">Estado: ${estadoNombre}</div>
                </div>
                
                <div>
                    <h4><i class="fas fa-money-bill-wave"></i> Recaudación</h4>
                    <div class="valor">${formatCurrency(peaje.revenue)}</div>
                    <div class="detalle">${porcentajeRecaudacion}% del total del Estado</div>
                </div>
                
                <div>
                    <h4><i class="fas fa-car"></i> Tránsito</h4>
                    <div class="valor">${formatFullNumber(peaje.transits)}</div>
                    <div class="detalle">${porcentajeTransito}% del total del Estado</div>
                </div>
            `;
            
            mapaInfo.style.display = 'block';
            mapaInfo.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function exportEstrategicoData() {
            const estadoFilter = document.getElementById('estrategico-estado-filter');
            const selectedOptions = Array.from(estadoFilter.selectedOptions).map(option => option.value);
            
            let estadosSeleccionados;
            if (selectedOptions.includes('all') || selectedOptions.length === 0) {
                estadosSeleccionados = tollSystemData.states.map(state => state.id);
            } else {
                estadosSeleccionados = selectedOptions;
            }
            
            const periodData = tollSystemData[estrategicoPeriod];
            const estadosData = tollSystemData.states.filter(state => estadosSeleccionados.includes(state.id));
            
            let totalRevenue = 0;
            let totalTransits = 0;
            
            estadosData.forEach(state => {
                totalRevenue += state.revenue;
                totalTransits += state.transits;
            });
            
            let topState = null;
            let maxRevenue = 0;
            
            estadosData.forEach(state => {
                if (state.revenue > maxRevenue) {
                    maxRevenue = state.revenue;
                    topState = state;
                }
            });
            
            let topToll = null;
            let topTollRevenue = 0;
            
            estadosSeleccionados.forEach(estadoId => {
                const peajes = operacionesData.peajesPorEstado[estadoId] || [];
                peajes.forEach(peaje => {
                    if (peaje.revenue > topTollRevenue) {
                        topTollRevenue = peaje.revenue;
                        topToll = peaje;
                    }
                });
            });
            
            let allPeajes = [];
            
            estadosSeleccionados.forEach(estadoId => {
                const peajes = operacionesData.peajesPorEstado[estadoId] || [];
                allPeajes = allPeajes.concat(peajes);
            });
            
            allPeajes.sort((a, b) => b.revenue - a.revenue);
            const topPeajes = allPeajes.slice(0, 10);
            
            const periodText = estrategicoPeriod === 'day' ? 'Día' : estrategicoPeriod === 'month' ? 'Mes' : 'Año';
            
            const exportData = {
                modulo: "Estratégico",
                periodo: periodText,
                fecha: new Date().toLocaleDateString('es-VE'),
                hora: new Date().toLocaleTimeString('es-VE'),
                filtros: {
                    estados: estadosSeleccionados
                },
                resumen: {
                    recaudacionTotal: totalRevenue,
                    transitoTotal: totalTransits,
                    estadoMayorRecaudacion: topState ? {
                        nombre: topState.name,
                        recaudacion: topState.revenue,
                        porcentaje: ((topState.revenue / totalRevenue) * 100).toFixed(1)
                    } : null,
                    peajeMayorRecaudacion: topToll ? {
                        nombre: topToll.name,
                        recaudacion: topToll.revenue,
                        porcentaje: ((topToll.revenue / totalRevenue) * 100).toFixed(1)
                    } : null
                },
                distribucionEstados: estadosData.map(state => {
                    const peajes = operacionesData.peajesPorEstado[state.id] || [];
                    return {
                        estado: state.name,
                        recaudacion: state.revenue,
                        transito: state.transits,
                        porcentaje: ((state.revenue / totalRevenue) * 100).toFixed(1),
                        peajes: peajes.length
                    };
                }),
                topPeajes: topPeajes.map(peaje => {
                    return {
                        peaje: peaje.name,
                        recaudacion: peaje.revenue,
                        transito: peaje.transits
                    };
                }),
                totalPeajes: allPeajes.length,
                fechaExportacion: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const downloadLink = document.createElement('a');
            downloadLink.href = URL.createObjectURL(dataBlob);
            downloadLink.download = `datos_estrategico_${periodText.toLowerCase()}_${new Date().toISOString().split('T')[0]}.json`;
            
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            alert(`Datos del módulo estratégico (período ${periodText}) exportados correctamente.`);
        }
        
        function initEjecutivoModule() {
            console.log("Inicializando módulo ejecutivo...");
            
            // Actualizar fecha y hora
            updateCurrentDateTime();
            
            // Actualizar datos del resumen ejecutivo
            updateEjecutivoSummary();
            
            // Inicializar gráfica de tendencia
            initEjecutivoTrendChart();
            
            // Cargar top peajes
            loadTopPeajes();
            
            // Configurar evento de exportación
            document.getElementById('export-ejecutivo-data').addEventListener('click', function() {
                exportEjecutivoData();
            });
        }
        
        function updateCurrentDateTime() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            };
            
            const dateTimeStr = now.toLocaleString('es-VE', options);
            
            document.getElementById('current-date-time').textContent = dateTimeStr;
        }
        
        function updateEjecutivoSummary() {
            const data = ejecutivoData.previousMonthComparison;
            
            // Formatear valores
            document.getElementById('ejecutivo-total-revenue').textContent = formatCurrency(data.revenue.current);
            document.getElementById('ejecutivo-total-transits').textContent = formatFullNumber(data.transits.current);
            document.getElementById('ejecutivo-exonerated-transits').textContent = formatFullNumber(data.exonerated.current);
            document.getElementById('ejecutivo-tag-transits').textContent = formatFullNumber(data.tag.current);
            
            // Contar peajes monitoreados (sumando todos los peajes de todos los estados)
            let totalPeajes = 0;
            Object.values(operacionesData.peajesPorEstado).forEach(peajes => {
                totalPeajes += peajes.length;
            });
            
            // Contar estados registrados
            const totalEstados = Object.keys(operacionesData.peajesPorEstado).length;
            
            // Actualizar información en el top peajes
            const infoDiv = document.getElementById('top-peajes-info');
            infoDiv.innerHTML = `<p><i class="fas fa-info-circle"></i> Total de peajes monitoreados: <strong>${totalPeajes}</strong> en <strong>${totalEstados}</strong> estados registrados.</p>`;
        }
        
        function initEjecutivoTrendChart() {
            const ctx = document.getElementById('ejecutivo-trend-chart').getContext('2d');
            const data = ejecutivoData.monthlyTrend;
            
            if (ejecutivoTrendChart) {
                ejecutivoTrendChart.destroy();
            }
            
            const isDarkMode = document.body.classList.contains('dark-mode');
            const lineColor = isDarkMode ? '#4d8aff' : '#2a5298';
            const transitColor = isDarkMode ? '#66bb6a' : '#4CAF50';
            
            ejecutivoTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        {
                            label: 'Recaudación',
                            data: data.revenue,
                            backgroundColor: isDarkMode ? 'rgba(77, 138, 255, 0.1)' : 'rgba(42, 82, 152, 0.1)',
                            borderColor: lineColor,
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Tránsitos',
                            data: data.transits,
                            backgroundColor: isDarkMode ? 'rgba(102, 187, 106, 0.1)' : 'rgba(76, 175, 80, 0.1)',
                            borderColor: transitColor,
                            borderWidth: 3,
                            fill: false,
                            tension: 0.3,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: isDarkMode ? '#e0e0e0' : '#333'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `Recaudación: ${formatCurrency(context.parsed.y)}`;
                                    } else {
                                        return `Tránsitos: ${formatFullNumber(context.parsed.y)}`;
                                    }
                                }
                            },
                            backgroundColor: isDarkMode ? '#2d2d2d' : '#ffffff',
                            titleColor: isDarkMode ? '#e0e0e0' : '#333',
                            bodyColor: isDarkMode ? '#e0e0e0' : '#333',
                            borderColor: isDarkMode ? '#444' : '#ddd'
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Recaudación (Bs.)',
                                color: isDarkMode ? '#e0e0e0' : '#333'
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                },
                                color: isDarkMode ? '#b0b0b0' : '#666'
                            },
                            grid: {
                                color: isDarkMode ? '#333' : '#e0e0e0'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Tránsitos',
                                color: isDarkMode ? '#e0e0e0' : '#333'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatFullNumber(value);
                                },
                                color: isDarkMode ? '#b0b0b0' : '#666'
                            }
                        },
                        x: {
                            ticks: {
                                color: isDarkMode ? '#b0b0b0' : '#666'
                            },
                            grid: {
                                color: isDarkMode ? '#333' : '#e0e0e0'
                            }
                        }
                    }
                }
            });
        }
        
        function loadTopPeajes() {
            const tableBody = document.getElementById('top-peajes-body');
            tableBody.innerHTML = '';
            
            ejecutivoData.topPeajes.forEach((peaje, index) => {
                const row = document.createElement('tr');
                
                let positionIcon = '';
                if (index === 0) {
                    positionIcon = '<i class="fas fa-trophy" style="color: #FFC107;"></i>';
                } else if (index === 1) {
                    positionIcon = '<i class="fas fa-medal" style="color: #9E9E9E;"></i>';
                } else {
                    positionIcon = '<i class="fas fa-award" style="color: #8D6E63;"></i>';
                }
                
                row.innerHTML = `
                    <td style="text-align: center; font-size: 18px;">${positionIcon}</td>
                    <td style="font-weight: 600;">${peaje.name}</td>
                    <td>${peaje.state}</td>
                    <td style="font-weight: 600;">${formatCurrency(peaje.revenue)}</td>
                    <td>${formatFullNumber(peaje.transits)}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        function exportEjecutivoData() {
            // Contar peajes monitoreados y estados registrados
            let totalPeajes = 0;
            Object.values(operacionesData.peajesPorEstado).forEach(peajes => {
                totalPeajes += peajes.length;
            });
            const totalEstados = Object.keys(operacionesData.peajesPorEstado).length;
            
            const exportData = {
                modulo: "Ejecutivo",
                titulo: "Resumen Ejecutivo Nacional",
                periodo: "23/12/2025 - 22/1/2026",
                fechaExportacion: new Date().toLocaleDateString('es-VE'),
                horaExportacion: new Date().toLocaleTimeString('es-VE'),
                resumen: {
                    recaudacionTotal: ejecutivoData.previousMonthComparison.revenue.current,
                    transitoTotal: ejecutivoData.previousMonthComparison.transits.current,
                    transitosExonerados: ejecutivoData.previousMonthComparison.exonerated.current,
                    transitosTag: ejecutivoData.previousMonthComparison.tag.current,
                    peajesMonitoreados: totalPeajes,
                    estadosRegistrados: totalEstados
                },
                comparativaMesAnterior: ejecutivoData.previousMonthComparison,
                tendenciaMensual: ejecutivoData.monthlyTrend,
                topPeajes: ejecutivoData.topPeajes,
                alertasEstrategicas: [
                    {
                        tipo: "Crítica",
                        titulo: "Alta Recaudación en Peaje Caracas",
                        descripcion: "El peaje Caracas superó el límite de recaudación diario en un 15%. Revisar capacidad operativa.",
                        fecha: "Detectada hoy a las 14:30"
                    },
                    {
                        tipo: "Advertencia",
                        titulo: "Caída en Tránsito - Estado Bolívar",
                        descripcion: "Reducción del 8% en tránsito en el estado Bolívar durante la última semana.",
                        fecha: "Detectada hace 2 días"
                    },
                    {
                        tipo: "Informativa",
                        titulo: "Incremento en Pagos Digitales",
                        descripcion: "Los pagos digitales (Tag + Pago móvil) aumentaron un 5% este mes.",
                        fecha: "Actualizada ayer"
                    },
                    {
                        tipo: "Informativa",
                        titulo: "Estado Mérida - Bajo Desempeño",
                        descripcion: "Recaudación 12% por debajo del promedio nacional en el estado Mérida.",
                        fecha: "Actualizada hace 3 días"
                    }
                ]
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const downloadLink = document.createElement('a');
            downloadLink.href = URL.createObjectURL(dataBlob);
            downloadLink.download = `datos_ejecutivo_${new Date().toISOString().split('T')[0]}.json`;
            
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            alert('Datos del módulo ejecutivo exportados correctamente.');
        }
        
        // Función para inicializar el módulo de usuarios
        function initUsuariosModule() {
            console.log("Inicializando módulo de usuarios...");
            
            // Cargar datos iniciales
            loadUsersTable();
            setupPagination();
            
            // Configurar eventos
            setupUsuariosEventListeners();
        }

        // Función para cargar la tabla de usuarios
        function loadUsersTable() {
            const tableBody = document.getElementById('users-table-body');
            tableBody.innerHTML = '';
            
            // Calcular índices para la paginación
            const startIndex = (currentUsersPage - 1) * usersPerPage;
            const endIndex = Math.min(startIndex + usersPerPage, filteredUsers.length);
            
            // Actualizar información de paginación
            document.getElementById('current-page-start').textContent = startIndex + 1;
            document.getElementById('current-page-end').textContent = endIndex;
            document.getElementById('total-users').textContent = filteredUsers.length;
            
            // Si no hay usuarios
            if (filteredUsers.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" style="text-align: center; padding: 35px; color: #666;">
                        <i class="fas fa-users fa-2x" style="margin-bottom: 12px; display: block; opacity: 0.5;"></i>
                        <p>No se encontraron usuarios con los filtros aplicados.</p>
                    </td>
                `;
                tableBody.appendChild(row);
                return;
            }
            
            // Llenar tabla con usuarios
            for (let i = startIndex; i < endIndex; i++) {
                const user = filteredUsers[i];
                const row = document.createElement('tr');
                
                // Capitalizar primera letra de rol
                const roleFormatted = user.role.charAt(0).toUpperCase() + user.role.slice(1);
                
                // Determinar clase para estatus (con mejor visualización)
                const statusFormatted = user.status === 'activo' ? 'Activo' : 'Inactivo';
                const statusClass = user.status === 'activo' ? 'status-active' : 'status-inactive';
                
                row.innerHTML = `
                    <td style="text-align: center;">
                        <a href="#" class="user-link" data-user-id="${user.id}">${user.username}</a>
                    </td>
                    <td style="text-align: center;">${user.firstname}</td>
                    <td style="text-align: center;">${user.lastname}</td>
                    <td style="text-align: center;">${user.cedula}</td>
                    <td style="text-align: center;">${roleFormatted}</td>
                    <td style="text-align: center;">
                        <span class="${statusClass}">${statusFormatted}</span>
                    </td>
                `;
                
                tableBody.appendChild(row);
            }
            
            // Actualizar números de página
            updatePaginationNumbers();
        }

        // Función para configurar la paginación
        function setupPagination() {
            const totalPages = Math.ceil(filteredUsers.length / usersPerPage);
            
            // Actualizar botones de paginación
            document.getElementById('first-page-btn').disabled = currentUsersPage === 1;
            document.getElementById('prev-page-btn').disabled = currentUsersPage === 1;
            document.getElementById('next-page-btn').disabled = currentUsersPage === totalPages;
            document.getElementById('last-page-btn').disabled = currentUsersPage === totalPages;
            
            // Actualizar números de página
            updatePaginationNumbers();
        }

        // Función para actualizar los números de página
        function updatePaginationNumbers() {
            const paginationNumbers = document.getElementById('pagination-numbers');
            paginationNumbers.innerHTML = '';
            
            const totalPages = Math.ceil(filteredUsers.length / usersPerPage);
            
            // Mostrar máximo 5 números de página
            let startPage = Math.max(1, currentUsersPage - 2);
            let endPage = Math.min(totalPages, currentUsersPage + 2);
            
            // Ajustar si estamos cerca del inicio
            if (currentUsersPage <= 3) {
                endPage = Math.min(5, totalPages);
            }
            
            // Ajustar si estamos cerca del final
            if (currentUsersPage >= totalPages - 2) {
                startPage = Math.max(1, totalPages - 4);
            }
            
            // Agregar botones de página
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('div');
                pageBtn.className = `page-number ${i === currentUsersPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    currentUsersPage = i;
                    loadUsersTable();
                    setupPagination();
                });
                
                paginationNumbers.appendChild(pageBtn);
            }
            
            // Agregar puntos suspensivos si es necesario
            if (startPage > 1) {
                const dots = document.createElement('div');
                dots.className = 'page-number';
                dots.textContent = '...';
                dots.style.cursor = 'default';
                paginationNumbers.insertBefore(dots, paginationNumbers.firstChild);
            }
            
            if (endPage < totalPages) {
                const dots = document.createElement('div');
                dots.className = 'page-number';
                dots.textContent = '...';
                dots.style.cursor = 'default';
                paginationNumbers.appendChild(dots);
            }
        }

        // Función para aplicar filtros
        function applyFilters() {
            // Obtener valor del filtro de búsqueda
            const searchFilter = document.getElementById('search-user').value.toLowerCase();
            
            // Guardar filtros actuales
            currentFilters = {
                search: searchFilter
            };
            
            // Aplicar filtros
            filteredUsers = usuariosData.filter(user => {
                // Filtrar por búsqueda
                if (searchFilter) {
                    const searchText = searchFilter.toLowerCase();
                    const fullName = `${user.firstname} ${user.lastname}`.toLowerCase();
                    const cedula = user.cedula.toLowerCase();
                    const username = user.username.toLowerCase();
                    
                    if (!fullName.includes(searchText) && 
                        !cedula.includes(searchText) && 
                        !username.includes(searchText)) {
                        return false;
                    }
                }
                
                return true;
            });
            
            // Resetear a la primera página
            currentUsersPage = 1;
            
            // Actualizar tabla y paginación
            loadUsersTable();
            setupPagination();
        }

        // Función para mostrar formulario de usuario (crear/editar)
        function showUserForm(userId = null) {
            const formModal = document.getElementById('user-form-modal');
            const modalTitle = document.getElementById('form-modal-title');
            const passwordField = document.getElementById('form-password');
            const confirmPasswordField = document.getElementById('form-confirm-password');
            
            if (userId) {
                // Modo edición
                modalTitle.textContent = 'Editar Usuario';
                const user = usuariosData.find(u => u.id === userId);
                
                if (user) {
                    document.getElementById('form-user-id').value = user.id;
                    document.getElementById('form-firstname').value = user.firstname;
                    document.getElementById('form-lastname').value = user.lastname;
                    document.getElementById('form-cedula').value = user.cedula;
                    document.getElementById('form-username').value = user.username;
                    document.getElementById('form-role').value = user.role;
                    document.getElementById('form-status').value = user.status;
                    // En edición, los campos de contraseña no son obligatorios
                    passwordField.value = '';
                    passwordField.placeholder = 'Dejar vacío para no cambiar';
                    passwordField.required = false;
                    confirmPasswordField.value = '';
                    confirmPasswordField.placeholder = 'Dejar vacío para no cambiar';
                    confirmPasswordField.required = false;
                }
            } else {
                // Modo creación
                modalTitle.textContent = 'Crear Nuevo Usuario';
                document.getElementById('user-form').reset();
                document.getElementById('form-user-id').value = '';
                // Establecer el estatus por defecto a activo
                document.getElementById('form-status').value = 'activo';
                // En creación, los campos de contraseña son obligatorios
                passwordField.placeholder = 'Contraseña *';
                passwordField.required = true;
                confirmPasswordField.placeholder = 'Confirmar Contraseña *';
                confirmPasswordField.required = true;
            }
            
            // Mostrar modal
            formModal.style.display = 'flex';
        }

        // Función para guardar usuario (crear/editar)
        function saveUser(event) {
            event.preventDefault();
            
            const userId = document.getElementById('form-user-id').value;
            const isEditMode = userId !== '';
            
            // Obtener valores del formulario
            const userData = {
                firstname: document.getElementById('form-firstname').value.trim(),
                lastname: document.getElementById('form-lastname').value.trim(),
                cedula: document.getElementById('form-cedula').value.trim(),
                username: document.getElementById('form-username').value.trim(),
                role: document.getElementById('form-role').value,
                status: document.getElementById('form-status').value
            };
            
            // Obtener contraseñas
            const password = document.getElementById('form-password').value;
            const confirmPassword = document.getElementById('form-confirm-password').value;
            
            // Validaciones básicas
            if (!userData.firstname || !userData.lastname || !userData.cedula || !userData.username || !userData.role || !userData.status) {
                alert('Por favor complete todos los campos obligatorios (*)');
                return;
            }
            
            // Validar contraseñas
            if (isEditMode) {
                // En edición, si se proporciona contraseña, validar
                if (password || confirmPassword) {
                    if (password !== confirmPassword) {
                        alert('Las contraseñas no coinciden');
                        return;
                    }
                    // Si se proporciona, actualizar
                    if (password) {
                        userData.password = password;
                    }
                }
            } else {
                // En creación, la contraseña es obligatoria
                if (!password || !confirmPassword) {
                    alert('La contraseña es obligatoria para crear un nuevo usuario');
                    return;
                }
                if (password !== confirmPassword) {
                    alert('Las contraseñas no coinciden');
                    return;
                }
                userData.password = password;
            }
            
            if (isEditMode) {
                // Editar usuario existente
                const userIndex = usuariosData.findIndex(u => u.id === parseInt(userId));
                if (userIndex !== -1) {
                    // Si no se proporciona contraseña, mantener la existente
                    if (!password) {
                        userData.password = usuariosData[userIndex].password;
                    }
                    
                    usuariosData[userIndex] = {
                        ...usuariosData[userIndex],
                        ...userData
                    };
                    
                    alert('Usuario actualizado correctamente');
                }
            } else {
                // Crear nuevo usuario
                // Generar ID único
                const newId = Math.max(...usuariosData.map(u => u.id)) + 1;
                
                const newUser = {
                    id: newId,
                    ...userData,
                    createdAt: new Date().toISOString().split('T')[0],
                    lastLogin: null
                };
                
                usuariosData.push(newUser);
                alert('Usuario creado correctamente');
            }
            
            // Cerrar modal
            closeModal('user-form-modal');
            
            // Aplicar filtros actuales y actualizar tabla
            applyFilters();
        }

        // Función para cerrar modales
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Función para configurar event listeners del módulo de usuarios
        function setupUsuariosEventListeners() {
            // Botón de filtro
            document.getElementById('filter-btn').addEventListener('click', () => {
                const filtersContainer = document.getElementById('user-filters');
                filtersContainer.style.display = filtersContainer.style.display === 'none' ? 'block' : 'none';
            });
            
            // Botón de crear usuario
            document.getElementById('create-user-btn').addEventListener('click', () => {
                showUserForm();
            });
            
            // Botones de aplicar y limpiar filtros
            document.getElementById('apply-filters-btn').addEventListener('click', applyFilters);
            
            document.getElementById('clear-filters-btn').addEventListener('click', () => {
                document.getElementById('search-user').value = '';
                applyFilters();
            });
            
            // Búsqueda en tiempo real
            document.getElementById('search-user').addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    applyFilters();
                }
            });
            
            // Cambiar número de usuarios por página
            document.getElementById('users-per-page').addEventListener('change', (e) => {
                usersPerPage = parseInt(e.target.value);
                currentUsersPage = 1;
                loadUsersTable();
                setupPagination();
            });
            
            // Botones de paginación
            document.getElementById('first-page-btn').addEventListener('click', () => {
                currentUsersPage = 1;
                loadUsersTable();
                setupPagination();
            });
            
            document.getElementById('prev-page-btn').addEventListener('click', () => {
                if (currentUsersPage > 1) {
                    currentUsersPage--;
                    loadUsersTable();
                    setupPagination();
                }
            });
            
            document.getElementById('next-page-btn').addEventListener('click', () => {
                const totalPages = Math.ceil(filteredUsers.length / usersPerPage);
                if (currentUsersPage < totalPages) {
                    currentUsersPage++;
                    loadUsersTable();
                    setupPagination();
                }
            });
            
            document.getElementById('last-page-btn').addEventListener('click', () => {
                const totalPages = Math.ceil(filteredUsers.length / usersPerPage);
                currentUsersPage = totalPages;
                loadUsersTable();
                setupPagination();
            });
            
            // Eventos para clic en enlaces de usuario (para editar)
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('user-link')) {
                    e.preventDefault();
                    const userId = parseInt(e.target.getAttribute('data-user-id'));
                    showUserForm(userId);
                }
            });
            
            // Cerrar modales
            document.getElementById('close-form-modal-btn').addEventListener('click', () => {
                closeModal('user-form-modal');
            });
            
            document.getElementById('cancel-form-btn').addEventListener('click', () => {
                closeModal('user-form-modal');
            });
            
            // Guardar usuario (formulario)
            document.getElementById('user-form').addEventListener('submit', saveUser);
            
            // Cerrar modal haciendo clic fuera de él
            window.addEventListener('click', (e) => {
                const userFormModal = document.getElementById('user-form-modal');
                const profileModal = document.getElementById('profile-modal');
                
                if (e.target === userFormModal) {
                    closeModal('user-form-modal');
                }
                
                if (e.target === profileModal) {
                    closeModal('profile-modal');
                }
            });
            
            // Botón de exportar datos
            document.getElementById('export-usuarios-data').addEventListener('click', function() {
                const exportData = {
                    modulo: "Usuarios",
                    fecha: new Date().toLocaleDateString('es-VE'),
                    hora: new Date().toLocaleTimeString('es-VE'),
                    totalUsuarios: usuariosData.length,
                    usuarios: usuariosData.map(user => ({
                        usuario: user.username,
                        nombre: user.firstname,
                        apellido: user.lastname,
                        cedula: user.cedula,
                        rol: user.role,
                        estatus: user.status,
                        fechaRegistro: user.createdAt,
                        ultimoLogin: user.lastLogin
                    }))
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const downloadLink = document.createElement('a');
                downloadLink.href = URL.createObjectURL(dataBlob);
                downloadLink.download = `datos_usuarios_${new Date().toISOString().split('T')[0]}.json`;
                
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                alert('Datos de usuarios exportados correctamente.');
            });
        }
        
        function setupEventListeners() {
            const timeFilterButtons = document.querySelectorAll('#module-operativo .time-filter-btn');
            
            timeFilterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    timeFilterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    currentPeriod = this.getAttribute('data-period');
                    updateDashboard(currentPeriod);
                });
            });
            
            const moduleItems = document.querySelectorAll('.module-item');
            
            moduleItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const moduleName = this.getAttribute('data-module');
                    
                    // Si es un elemento con submenú, solo alternamos el submenú
                    if (this.classList.contains('has-submenu')) {
                        // Alternar la clase active en este elemento
                        document.querySelectorAll('.module-item.has-submenu').forEach(el => {
                            if (el !== this) {
                                el.classList.remove('active');
                            }
                        });
                        this.classList.toggle('active');
                        
                        // No ocultamos otros módulos ni mostramos un módulo específico
                        return;
                    }
                    
                    // Para elementos normales sin submenú
                    moduleItems.forEach(btn => {
                        if (!btn.classList.contains('has-submenu')) {
                            btn.classList.remove('active');
                        }
                    });
                    this.classList.add('active');
                    
                    // Si había algún submenú abierto, lo cerramos
                    document.querySelectorAll('.module-item.has-submenu').forEach(el => {
                        el.classList.remove('active');
                    });
                    
                    const pageTitle = document.querySelector('.page-title h1');
                    const pageSubtitle = document.querySelector('.page-title .subtitle');
                    
                    document.querySelectorAll('.module-container').forEach(module => {
                        module.style.display = 'none';
                    });
                    
                    const selectedModule = document.getElementById('module-' + moduleName);
                    if (selectedModule) {
                        selectedModule.style.display = 'block';
                        
                        // Para los reportes, mostrar el formulario y ocultar resultados
                        if (moduleName.startsWith('reporte')) {
                            document.querySelectorAll('.report-results-container').forEach(container => {
                                container.style.display = 'none';
                            });
                            document.querySelectorAll('.report-form-container').forEach(container => {
                                container.style.display = 'block';
                            });
                        }
                        
                        if (moduleName === 'operaciones') {
                            initOperacionesModule();
                        }
                        if (moduleName === 'estrategico') {
                            pageTitle.innerHTML = '<i class="fas fa-chart-line"></i> Panel Estratégico';
                            pageSubtitle.textContent = 'Comparativa entre peajes nacionales';
                            initEstrategicoModule();
                        }
                        if (moduleName === 'ejecutivo') {
                            pageTitle.innerHTML = '<i class="fas fa-users"></i> Resumen Ejecutivo Nacional';
                            pageSubtitle.textContent = 'Informe estratégico para toma de decisiones - Últimos 30 días';
                            initEjecutivoModule();
                        }
                        if (moduleName === 'usuarios') {
                            pageTitle.innerHTML = '<i class="fas fa-user-friends"></i> Gestión de Usuarios';
                            pageSubtitle.textContent = 'Lista de usuarios registrados en el sistema';
                            initUsuariosModule();
                        }
                    }
                    
                    if (window.innerWidth <= 768) {
                        document.getElementById('sidebar').classList.remove('active');
                    }
                    
                    console.log(`Módulo seleccionado: ${moduleName}`);
                });
            });
            
            // Botón de perfil
            document.getElementById('profileBtn').addEventListener('click', function() {
                document.getElementById('profile-modal').style.display = 'flex';
            });
            
            // Botón de cerrar sesión (ahora abre el modal de confirmación)
            document.getElementById('logoutBtn').addEventListener('click', function() {
                document.getElementById('logout-confirm-modal').classList.add('active');
            });
            
            // Botones del modal de confirmación de cierre de sesión
            document.getElementById('cancel-logout-btn').addEventListener('click', function() {
                document.getElementById('logout-confirm-modal').classList.remove('active');
            });
            
            document.getElementById('confirm-logout-btn').addEventListener('click', function() {
                document.getElementById('logout-confirm-modal').classList.remove('active');
                alert('Cerrando sesión... Redirigiendo a la página de inicio de sesión.');
            });
            
            // Cerrar modal de confirmación al hacer clic fuera
            document.getElementById('logout-confirm-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
            
            // Botones del modal de perfil
            document.getElementById('close-profile-modal-btn').addEventListener('click', function() {
                closeModal('profile-modal');
            });
            
            document.getElementById('cancel-profile-btn').addEventListener('click', function() {
                closeModal('profile-modal');
            });
            
            document.getElementById('save-profile-btn').addEventListener('click', function() {
                const newPassword = document.getElementById('profile-new-password').value;
                const confirmPassword = document.getElementById('profile-confirm-password').value;
                
                // Validar que si se llena uno, se llenen ambos
                if (newPassword || confirmPassword) {
                    if (!newPassword || !confirmPassword) {
                        alert('Para cambiar la contraseña, debe completar ambos campos de contraseña.');
                        return;
                    }
                    
                    if (newPassword !== confirmPassword) {
                        alert('La nueva contraseña y la confirmación no coinciden.');
                        return;
                    }
                    
                    // Aquí iría el cambio de contraseña
                    
                    alert('Contraseña cambiada correctamente.');
                    
                    // Limpiar campos de contraseña
                    document.getElementById('profile-new-password').value = '';
                    document.getElementById('profile-confirm-password').value = '';
                } else {
                    alert('Perfil actualizado (sin cambiar contraseña).');
                }
                
                closeModal('profile-modal');
            });
            
            document.getElementById('export-data').addEventListener('click', function() {
                const periodText = currentPeriod === 'day' ? 'Día' : currentPeriod === 'month' ? 'Mes' : 'Año';
                const exportData = {
                    periodo: periodText,
                    fecha: new Date().toLocaleDateString('es-VE'),
                    hora: new Date().toLocaleTimeString('es-VE'),
                    recaudacionTotal: tollSystemData[currentPeriod].totalRevenue,
                    transitosTotales: tollSystemData[currentPeriod].totalTransits,
                    transitosExonerados: tollSystemData[currentPeriod].exoneratedTransits,
                    transitosTag: tollSystemData[currentPeriod].tagTransits,
                    estados: tollSystemData.states,
                    categoriasVehiculos: tollSystemData[currentPeriod].vehicleCategories,
                    metodosPago: tollSystemData[currentPeriod].paymentMethods
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const downloadLink = document.createElement('a');
                downloadLink.href = URL.createObjectURL(dataBlob);
                downloadLink.download = `datos_peajes_${periodText.toLowerCase()}_${new Date().toISOString().split('T')[0]}.json`;
                
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                alert(`Datos del módulo operativo (período ${periodText}) exportados correctamente.`);
            });
            
            document.getElementById('toggleSidebar').addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('collapsed');
                
                // Guardar estado en localStorage
                localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
            });
            
            document.getElementById('darkModeToggle').addEventListener('change', function() {
                const isDarkMode = this.checked;
                document.body.classList.toggle('dark-mode', isDarkMode);
                
                // Guardar preferencia en localStorage
                localStorage.setItem('darkMode', isDarkMode);
                
                // Actualizar gráficos si existen
                if (trendChart) {
                    trendChart.destroy();
                    initTrendChart(currentPeriod);
                }
                if (statesChart) {
                    statesChart.destroy();
                    initStatesChart();
                }
                if (vehicleCategoriesChart) {
                    vehicleCategoriesChart.destroy();
                    initVehicleCategoriesChart(currentPeriod);
                }
                if (paymentMethodsChart) {
                    paymentMethodsChart.destroy();
                    initPaymentMethodsChart(currentPeriod);
                }
                if (paymentChannelChart) {
                    paymentChannelChart.destroy();
                    initPaymentChannelChart(operacionesPeriod);
                }
            });
            
            document.getElementById('menuToggle').addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('active');
                
                // Si la barra lateral está activa, asegurarse de que no esté colapsada en móviles
                if (sidebar.classList.contains('active')) {
                    sidebar.classList.remove('collapsed');
                }
            });
            
            // Cerrar sidebar en móviles al hacer clic
            document.addEventListener('click', function(e) {
                const sidebar = document.getElementById('sidebar');
                const menuToggle = document.getElementById('menuToggle');
                
                if (window.innerWidth <= 768 && sidebar.classList.contains('active') && 
                    !sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
                    sidebar.classList.remove('active');
                }
            });
        }
        
        function checkDarkModePreference() {
            const darkModeToggle = document.getElementById('darkModeToggle');
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            
            document.body.classList.toggle('dark-mode', isDarkMode);
            darkModeToggle.checked = isDarkMode;
        }
        
        function checkSidebarState() {
            const sidebar = document.getElementById('sidebar');
            const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            
            if (isCollapsed) {
                sidebar.classList.add('collapsed');
            }
            
            if (window.innerWidth <= 992) {
                sidebar.classList.add('collapsed');
                localStorage.setItem('sidebarCollapsed', 'true');
            }
        }
        
        function updateDashboard(period) {
            updateMainCards(period);
            
            if (trendChart) {
                trendChart.destroy();
                initTrendChart(period);
            }
            
            if (vehicleCategoriesChart) {
                vehicleCategoriesChart.destroy();
                initVehicleCategoriesChart(period);
            }
            
            if (paymentMethodsChart) {
                paymentMethodsChart.destroy();
                initPaymentMethodsChart(period);
            }
            
            console.log(`Dashboard actualizado para período: ${period}`);
        }
    </script>
</body>
</html>
